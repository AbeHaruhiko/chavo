require('cloud/app.js');
Parse.Cloud.define('hello', function (request, response) {
    response.success('Hello world!');
});
Parse.Cloud.define('toggleLike', function (request, response) {
    // 人のvoiceのlikceCountをincrementするのでuseMasterKey
    // Parse.Cloud.useMasterKey();
    var voice = request.params.voice;
    // ↓のトグルはローカルで実施済み
    // voice.like = !voice.like;
    var ParseVoice = Parse.Object.extend('Voice');
    var parseVoice = new ParseVoice();
    parseVoice.id = voice.objectId;
    if (voice.like) {
        request.user.addUnique('likes', voice.objectId);
        parseVoice.increment('likeCount');
    }
    else {
        request.user.remove('likes', voice.objectId);
        parseVoice.increment('likeCount', -1);
    }
    request.user.save()
        .then(function (user) {
        console.log('user: ' + user);
        console.log('likes: ' + user.get('likes'));
        return parseVoice.save(null, { useMasterKey: true });
    })
        .then(function (parseVoice) {
        console.log('likeCound: ' + parseVoice.get('likeCount'));
        response.success(parseVoice.get('likeCount'));
    }, function (error) {
        console.error('Error: ' + error.code + ' ' + error.message);
        response.error('Error: ' + error.code + ' ' + error.message);
    });
});
Parse.Cloud.define('saveTag', function (request, response) {
    var tags = request.params.tags;
    tags.forEach(function (tag) {
        console.log(tag);
        var ParseTag = Parse.Object.extend('Tag');
        var query = new Parse.Query(ParseTag);
        query.equalTo('tag', tag);
        query.count().then(function (count) {
            console.log('count: ' + count);
            if (count === 0) {
                var parseTag = new ParseTag();
                parseTag.set('tag', tag);
                return parseTag.save();
            }
            else {
                return Parse.Promise.as(null);
            }
        })
            .then(function (parseTag) {
            if (parseTag) {
                console.log('saved tag: ' + parseTag.get('tag'));
            }
            response.success('');
        });
    });
});
Parse.Cloud.define('addFamily', function (request, response) {
    // 人のChildを共有するようにACLを編集したりRoleを作ったりするのでマスターキー使用。
    Parse.Cloud.useMasterKey();
    // toUserIdかfromUserIdの家族を表すRoleがあるか
    var toUser = new Parse.User();
    var fromUser = new Parse.User();
    // 申請先ユーザ（承認者）
    toUser.id = request.user.id;
    // 申請元ユーザ（申請者）
    fromUser.id = request.params.familyApplication.fromUserObjectId;
    // 申請者、承認者のFamilyデータを検索する。
    var familyQuery = new Parse.Query('Family');
    familyQuery.containedIn('member', [request.user, fromUser]);
    var family;
    var familyRole;
    familyQuery.first()
        .then(function (family) {
        console.log('enter 1');
        console.log(family);
        if (!family) {
            console.log('既存familyなし');
            // 既存のFamilyがないので作る。
            var ParseFamily = Parse.Object.extend('Family');
            family = new ParseFamily();
            family.setACL(new Parse.ACL());
        }
        var relation = family.relation('member');
        relation.add(toUser);
        relation.add(fromUser);
        return family.save();
    }).then(function (result) {
        console.log('enter 2');
        console.log(result);
        family = result;
        // .FamilyのオブジェクトIDをnameに持つRoleを探す。
        var familyRoleQuery = new Parse.Query(Parse.Role);
        console.log(result.id);
        familyRoleQuery.equalTo('name', result.id);
        return familyRoleQuery.first();
    }).then(function (result) {
        console.log('enter 3');
        console.log(result);
        if (result) {
            console.log('ロールあり: name = ' + family.id + ': ' + result);
            familyRole = result;
        }
        else {
            // 既存Roleがなければ作る。
            familyRole = new Parse.Role(family.id, new Parse.ACL());
            console.log('ロールなし: name = ' + family.id + 'を作ります。');
        }
        console.log(familyRole.getUsers());
        familyRole.getUsers().add(toUser);
        familyRole.getUsers().add(fromUser);
        return familyRole.save();
    }).then(function (result) {
        console.log('enter 4');
        console.log(result);
        // 承認者と申請者のこども情報を取得
        var ParseChild = Parse.Object.extend('Child');
        var query = new Parse.Query(ParseChild);
        query.containedIn('createdBy', [toUser, fromUser]);
        return query.find();
    }).then(function (parseChildren) {
        console.log('parseChildren:' + parseChildren);
        var promises = [];
        parseChildren.forEach(function (parseChild) {
            console.log('parseChild:' + parseChild);
            var childACL = new Parse.ACL();
            childACL.setRoleReadAccess(familyRole, true);
            childACL.setRoleWriteAccess(familyRole, true);
            parseChild.setACL(childACL);
        });
        promises.push(Parse.Object.saveAll(parseChildren));
        return Parse.Promise.when(promises);
    }).then(function () {
        console.log('enter 5');
        // 全投稿を取得
        var ParseVoice = Parse.Object.extend('Voice');
        // TODO: 'user'でなく'createdBy'にしたい。
        var query = new Parse.Query(ParseVoice);
        query.containedIn('user', [toUser, fromUser]);
        return query.count();
    }).then(function (countResult) {
        console.log('countResult:' + countResult);
        var promises = [];
        var ParseVoice = Parse.Object.extend('Voice');
        // TODO: 'user'でなく'createdBy'にしたい。
        var query = new Parse.Query(ParseVoice);
        query.containedIn('user', [toUser, fromUser]);
        for (var i = 0; i < countResult / 1000; i++) {
            query.limit(1000);
            query.skip(1000 * i);
            promises.push(query.find());
        }
        return Parse.Promise.when(promises);
    }).then(function () {
        var voicesArray = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            voicesArray[_i - 0] = arguments[_i];
        }
        console.log('voices:' + voicesArray);
        var promises = [];
        voicesArray.forEach(function (voices) {
            voices.forEach(function (voice) {
                console.log('voice:' + voice.id + ':' + familyRole.id);
                var voiceACL = new Parse.ACL();
                voiceACL.setRoleReadAccess(familyRole, true);
                voiceACL.setRoleWriteAccess(familyRole, true);
                if (voice.getACL().getPublicReadAccess()) {
                    voiceACL.setPublicReadAccess(true);
                    console.log('voice: setPublicReadAccess');
                }
                voice.setACL(voiceACL);
            });
            promises.push(Parse.Object.saveAll(voices));
            return Parse.Promise.when(promises);
        });
    }).then(function () {
        console.log('enter 6');
        response.success('Success!');
    }, function (error) {
        console.error('Error: ' + error.code + ' ' + error.message);
        response.error('Error! see log on Parse.com.');
    });
});
Parse.Cloud.define('getRequestUsersFamilyRole', function (request, response) {
    Parse.Cloud.useMasterKey();
    var familyQuery = new Parse.Query('Family');
    familyQuery.equalTo('member', request.user);
    familyQuery.first()
        .then(function (result) {
        if (result) {
            var roleQuery = new Parse.Query(Parse.Role);
            roleQuery.equalTo('name', result.id);
            return roleQuery.first();
        }
        else {
            return Parse.Promise.as(null);
        }
    }).then(function (result) {
        response.success(result);
    });
});
Parse.Cloud.define('getRequestUsersFamilyMember', function (request, response) {
    Parse.Cloud.useMasterKey();
    var familyQuery = new Parse.Query('Family');
    familyQuery.containedIn('member', [request.user]);
    familyQuery.first()
        .then(function (result) {
        console.log(result);
        if (result) {
            var query = result.relation('member').query();
            // 他ユーザに返却するのでパスワードなどは返さない。
            query.select('username', 'iconUrl');
            return query.find();
        }
        else {
            return;
        }
    }).then(function (result) {
        console.log(result);
        response.success(result);
    }, function (error) {
        response.error(error);
    });
});
Parse.Cloud.define('getFamilyAppToRequestUser', function (request, response) {
    Parse.Cloud.useMasterKey();
    var ParseFamilyApplication = Parse.Object.extend('FamilyApplication');
    var query = new Parse.Query(ParseFamilyApplication);
    query.descending('createdAt');
    // 自分宛て
    query.equalTo('toUser', request.user);
    query.include('fromUser');
    query.find()
        .then(function (result) {
        response.success(result);
    }, function (error) {
        response.error(error);
    });
});
Parse.Cloud.define('getCountOfFamilyAppToRequestUser', function (request, response) {
    Parse.Cloud.useMasterKey();
    var ParseFamilyApplication = Parse.Object.extend('FamilyApplication');
    var query = new Parse.Query(ParseFamilyApplication);
    query.descending('createdAt');
    // 自分宛て
    query.equalTo('toUser', request.user);
    query.include('fromUser');
    query.count()
        .then(function (count) {
        response.success(count);
    }, function (error) {
        response.error(error);
    });
});
Parse.Cloud.define('getFamilyAppFromRequestUser', function (request, response) {
    Parse.Cloud.useMasterKey();
    var ParseFamilyApplication = Parse.Object.extend('FamilyApplication');
    var query = new Parse.Query(ParseFamilyApplication);
    query.descending('createdAt');
    // 自分宛て
    query.equalTo('fromUser', request.user);
    query.include('fromUser');
    query.include('toUser');
    query.find()
        .then(function (result) {
        response.success(result);
    }, function (error) {
        response.error(error);
    });
});
var ParseImage = require('parse-image');
/*
 * プロフィール保存時に画像を160pxにリサイズ
 */
Parse.Cloud.beforeSave('_User', function (request, response) {
    var user = request.object;
    if (!user.get('icon')) {
        response.success(user);
        return;
    }
    if (!user.dirty('icon')) {
        // .The profile photo isn't being modified.
        response.success(user);
        return;
    }
    Parse.Cloud.httpRequest({
        // _UserのbeforeSaveなので、iconUrlはまだ更新されていないのでicon.url()を使う。
        url: user.get('icon').url()
    }).then(function (response) {
        console.log(3);
        var image = new ParseImage();
        return image.setData(response.buffer);
    }).then(function (image) {
        // .Crop the image to the smaller of width or height.
        var size = Math.min(image.width(), image.height());
        return image.crop({
            left: (image.width() - size) / 2,
            top: (image.height() - size) / 2,
            width: size,
            height: size
        });
    }).then(function (image) {
        // .Resize the image to 64x64.
        return image.scale({
            width: 160,
            height: 160
        });
    }).then(function (image) {
        // .Make sure it's a JPEG to save disk space and bandwidth.
        return image.setFormat('JPEG');
    }).then(function (image) {
        // .Get the image data in a Buffer.
        return image.data();
    }).then(function (buffer) {
        // .Save the image into a new file.
        var base64 = buffer.toString('base64');
        var cropped = new Parse.File('photo.jpg', { base64: base64 });
        return cropped.save();
    }).then(function (cropped) {
        // .Attach the image file to the original object.
        user.set('icon', cropped);
        user.set('iconUrl', cropped.url());
    }).then(function () {
        response.success(user);
    }, function (error) {
        console.log(9);
        response.error(error);
    });
});
/*
 * 投稿に画像を480pxにリサイズ
 */
Parse.Cloud.beforeSave('Voice', function (request, response) {
    var voice = request.object;
    if (!voice.get('photo')) {
        response.success(voice);
        return;
    }
    if (!voice.dirty('photo')) {
        // .The profile photo isn't being modified.
        response.success(voice);
        return;
    }
    Parse.Cloud.httpRequest({
        // .VoiceのbeforeSaveなので、photoUrlはまだ更新されていないのでphoto.url()を使う。
        url: voice.get('photo').url()
    }).then(function (response) {
        console.log('before save voice: 4');
        var image = new ParseImage();
        return image.setData(response.buffer);
    }).then(function (image) {
        // .Resize the image to 64x64.
        var scale = 480 / Math.max(image.width(), image.height());
        return image.scale({
            width: image.width() * scale,
            height: image.height() * scale
        });
    }).then(function (image) {
        // .Make sure it's a JPEG to save disk space and bandwidth.
        return image.setFormat('JPEG');
    }).then(function (image) {
        // .Get the image data in a Buffer.
        return image.data();
    }).then(function (buffer) {
        // .Save the image into a new file.
        var base64 = buffer.toString('base64');
        var cropped = new Parse.File('photo.jpg', { base64: base64 });
        return cropped.save();
    }).then(function (cropped) {
        // .Attach the image file to the original object.
        voice.set('photo', cropped);
        voice.set('photoUrl', cropped.url());
    }).then(function () {
        response.success(voice);
    }, function (error) {
        console.log(9);
        response.error(error);
    });
});

//# sourceMappingURL=data:application/json;base64,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eEIsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJjbG91ZC9tYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsicmVxdWlyZSgnY2xvdWQvYXBwLmpzJyk7XG5cblBhcnNlLkNsb3VkLmRlZmluZSgnaGVsbG8nLCBmdW5jdGlvbihyZXF1ZXN0OiBQYXJzZS5DbG91ZC5GdW5jdGlvblJlcXVlc3QsIHJlc3BvbnNlOiBQYXJzZS5DbG91ZC5GdW5jdGlvblJlc3BvbnNlKSB7XG4gIHJlc3BvbnNlLnN1Y2Nlc3MoJ0hlbGxvIHdvcmxkIScpO1xufSk7XG5cblBhcnNlLkNsb3VkLmRlZmluZSgndG9nZ2xlTGlrZScsIGZ1bmN0aW9uKHJlcXVlc3Q6IFBhcnNlLkNsb3VkLkZ1bmN0aW9uUmVxdWVzdCwgcmVzcG9uc2U6IFBhcnNlLkNsb3VkLkZ1bmN0aW9uUmVzcG9uc2UpIHtcblxuICAvLyDkurrjga52b2ljZeOBrmxpa2NlQ291bnTjgpJpbmNyZW1lbnTjgZnjgovjga7jgad1c2VNYXN0ZXJLZXlcbiAgLy8gUGFyc2UuQ2xvdWQudXNlTWFzdGVyS2V5KCk7XG4gIHZhciB2b2ljZSA9IHJlcXVlc3QucGFyYW1zLnZvaWNlO1xuICAvLyDihpPjga7jg4jjgrDjg6vjga/jg63jg7zjgqvjg6vjgaflrp/mlr3muIjjgb9cbiAgLy8gdm9pY2UubGlrZSA9ICF2b2ljZS5saWtlO1xuXG4gIHZhciBQYXJzZVZvaWNlID0gUGFyc2UuT2JqZWN0LmV4dGVuZCgnVm9pY2UnKTtcbiAgdmFyIHBhcnNlVm9pY2UgPSBuZXcgUGFyc2VWb2ljZSgpO1xuICBwYXJzZVZvaWNlLmlkID0gdm9pY2Uub2JqZWN0SWQ7XG5cbiAgaWYgKHZvaWNlLmxpa2UpIHtcbiAgICByZXF1ZXN0LnVzZXIuYWRkVW5pcXVlKCdsaWtlcycsIHZvaWNlLm9iamVjdElkKTtcbiAgICBwYXJzZVZvaWNlLmluY3JlbWVudCgnbGlrZUNvdW50Jyk7XG4gIH0gZWxzZSB7XG4gICAgcmVxdWVzdC51c2VyLnJlbW92ZSgnbGlrZXMnLCB2b2ljZS5vYmplY3RJZCk7XG4gICAgcGFyc2VWb2ljZS5pbmNyZW1lbnQoJ2xpa2VDb3VudCcsIC0xKTtcbiAgfVxuXG4gIHJlcXVlc3QudXNlci5zYXZlKClcbiAgLnRoZW4oKHVzZXI6IFBhcnNlLlVzZXIpID0+IHtcbiAgICBjb25zb2xlLmxvZygndXNlcjogJyArIHVzZXIpO1xuICAgIGNvbnNvbGUubG9nKCdsaWtlczogJyArIHVzZXIuZ2V0KCdsaWtlcycpKTtcbiAgICByZXR1cm4gcGFyc2VWb2ljZS5zYXZlKG51bGwsIHsgdXNlTWFzdGVyS2V5OiB0cnVlIH0pO1xuICB9KVxuICAudGhlbigocGFyc2VWb2ljZTogUGFyc2UuT2JqZWN0KSA9PiB7XG4gICAgY29uc29sZS5sb2coJ2xpa2VDb3VuZDogJyArIHBhcnNlVm9pY2UuZ2V0KCdsaWtlQ291bnQnKSk7XG4gICAgcmVzcG9uc2Uuc3VjY2VzcyhwYXJzZVZvaWNlLmdldCgnbGlrZUNvdW50JykpO1xuICB9LFxuICAoZXJyb3I6IFBhcnNlLkVycm9yKSA9PiB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3I6ICcgKyBlcnJvci5jb2RlICsgJyAnICsgZXJyb3IubWVzc2FnZSk7XG4gICAgcmVzcG9uc2UuZXJyb3IoJ0Vycm9yOiAnICsgZXJyb3IuY29kZSArICcgJyArIGVycm9yLm1lc3NhZ2UpO1xuICB9KTtcblxufSk7XG5cblBhcnNlLkNsb3VkLmRlZmluZSgnc2F2ZVRhZycsIGZ1bmN0aW9uKHJlcXVlc3Q6IFBhcnNlLkNsb3VkLkZ1bmN0aW9uUmVxdWVzdCwgcmVzcG9uc2U6IFBhcnNlLkNsb3VkLkZ1bmN0aW9uUmVzcG9uc2UpIHtcbiAgdmFyIHRhZ3M6IHN0cmluZ1tdID0gcmVxdWVzdC5wYXJhbXMudGFncztcblxuICB0YWdzLmZvckVhY2goKHRhZzogc3RyaW5nKSA9PiB7XG4gICAgY29uc29sZS5sb2codGFnKTtcbiAgICB2YXIgUGFyc2VUYWcgPSBQYXJzZS5PYmplY3QuZXh0ZW5kKCdUYWcnKTtcblxuICAgIHZhciBxdWVyeSA9IG5ldyBQYXJzZS5RdWVyeShQYXJzZVRhZyk7XG4gICAgcXVlcnkuZXF1YWxUbygndGFnJywgdGFnKTtcbiAgICBxdWVyeS5jb3VudCgpLnRoZW4oKGNvdW50OiBudW1iZXIpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdjb3VudDogJyArIGNvdW50KTtcbiAgICAgIGlmIChjb3VudCA9PT0gMCkge1xuICAgICAgICB2YXIgcGFyc2VUYWcgPSBuZXcgUGFyc2VUYWcoKTtcbiAgICAgICAgcGFyc2VUYWcuc2V0KCd0YWcnLCB0YWcpO1xuICAgICAgICByZXR1cm4gcGFyc2VUYWcuc2F2ZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFBhcnNlLlByb21pc2UuYXMobnVsbCk7XG4gICAgICB9XG4gICAgfSlcbiAgICAudGhlbigocGFyc2VUYWc6IFBhcnNlLk9iamVjdCkgPT4ge1xuICAgICAgaWYgKHBhcnNlVGFnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdzYXZlZCB0YWc6ICcgKyBwYXJzZVRhZy5nZXQoJ3RhZycpKTtcbiAgICAgIH1cbiAgICAgIHJlc3BvbnNlLnN1Y2Nlc3MoJycpO1xuICAgIH0pO1xuICB9KTtcblxufSk7XG5cblBhcnNlLkNsb3VkLmRlZmluZSgnYWRkRmFtaWx5JywgZnVuY3Rpb24ocmVxdWVzdDogUGFyc2UuQ2xvdWQuRnVuY3Rpb25SZXF1ZXN0LCByZXNwb25zZTogUGFyc2UuQ2xvdWQuRnVuY3Rpb25SZXNwb25zZSkge1xuXG4gIC8vIOS6uuOBrkNoaWxk44KS5YWx5pyJ44GZ44KL44KI44GG44GrQUNM44KS57eo6ZuG44GX44Gf44KKUm9sZeOCkuS9nOOBo+OBn+OCiuOBmeOCi+OBruOBp+ODnuOCueOCv+ODvOOCreODvOS9v+eUqOOAglxuICBQYXJzZS5DbG91ZC51c2VNYXN0ZXJLZXkoKTtcblxuICAvLyB0b1VzZXJJZOOBi2Zyb21Vc2VySWTjga7lrrbml4/jgpLooajjgZlSb2xl44GM44GC44KL44GLXG4gIHZhciB0b1VzZXIgPSBuZXcgUGFyc2UuVXNlcigpO1xuICB2YXIgZnJvbVVzZXIgPSBuZXcgUGFyc2UuVXNlcigpO1xuXG4gIC8vIOeUs+iri+WFiOODpuODvOOCtu+8iOaJv+iqjeiAhe+8iVxuICB0b1VzZXIuaWQgPSByZXF1ZXN0LnVzZXIuaWQ7XG4gIC8vIOeUs+iri+WFg+ODpuODvOOCtu+8iOeUs+iri+iAhe+8iVxuICBmcm9tVXNlci5pZCA9IHJlcXVlc3QucGFyYW1zLmZhbWlseUFwcGxpY2F0aW9uLmZyb21Vc2VyT2JqZWN0SWQ7XG5cbiAgLy8g55Sz6KuL6ICF44CB5om/6KqN6ICF44GuRmFtaWx544OH44O844K/44KS5qSc57Si44GZ44KL44CCXG4gIHZhciBmYW1pbHlRdWVyeSA9IG5ldyBQYXJzZS5RdWVyeSgnRmFtaWx5Jyk7XG4gIGZhbWlseVF1ZXJ5LmNvbnRhaW5lZEluKCdtZW1iZXInLCBbIHJlcXVlc3QudXNlciwgZnJvbVVzZXIgXSk7XG5cbiAgdmFyIGZhbWlseTogUGFyc2UuT2JqZWN0O1xuICB2YXIgZmFtaWx5Um9sZTogUGFyc2UuUm9sZTtcbiAgZmFtaWx5UXVlcnkuZmlyc3QoKVxuICAudGhlbigoZmFtaWx5OiBQYXJzZS5PYmplY3QpID0+IHtcbiAgICBjb25zb2xlLmxvZygnZW50ZXIgMScpO1xuICAgIGNvbnNvbGUubG9nKGZhbWlseSk7XG5cbiAgICBpZiAoIWZhbWlseSkge1xuICAgICAgY29uc29sZS5sb2coJ+aXouWtmGZhbWlseeOBquOBlycpO1xuICAgICAgLy8g5pei5a2Y44GuRmFtaWx544GM44Gq44GE44Gu44Gn5L2c44KL44CCXG4gICAgICB2YXIgUGFyc2VGYW1pbHkgPSBQYXJzZS5PYmplY3QuZXh0ZW5kKCdGYW1pbHknKTtcbiAgICAgIGZhbWlseSA9IG5ldyBQYXJzZUZhbWlseSgpO1xuICAgICAgZmFtaWx5LnNldEFDTChuZXcgUGFyc2UuQUNMKCkpO1xuICAgIH1cbiAgICB2YXIgcmVsYXRpb24gPSBmYW1pbHkucmVsYXRpb24oJ21lbWJlcicpO1xuICAgIHJlbGF0aW9uLmFkZCh0b1VzZXIpO1xuICAgIHJlbGF0aW9uLmFkZChmcm9tVXNlcik7XG4gICAgcmV0dXJuIGZhbWlseS5zYXZlKCk7XG5cbiAgfSkudGhlbigocmVzdWx0OiBQYXJzZS5PYmplY3QpID0+IHtcbiAgICBjb25zb2xlLmxvZygnZW50ZXIgMicpO1xuICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XG5cbiAgICBmYW1pbHkgPSByZXN1bHQ7XG5cbiAgICAvLyAuRmFtaWx544Gu44Kq44OW44K444Kn44Kv44OISUTjgpJuYW1l44Gr5oyB44GkUm9sZeOCkuaOouOBmeOAglxuICAgIHZhciBmYW1pbHlSb2xlUXVlcnkgPSBuZXcgUGFyc2UuUXVlcnkoUGFyc2UuUm9sZSk7XG4gICAgY29uc29sZS5sb2cocmVzdWx0LmlkKTtcbiAgICBmYW1pbHlSb2xlUXVlcnkuZXF1YWxUbygnbmFtZScsIHJlc3VsdC5pZCk7XG4gICAgcmV0dXJuIGZhbWlseVJvbGVRdWVyeS5maXJzdCgpO1xuXG4gIH0pLnRoZW4oKHJlc3VsdDogUGFyc2UuUm9sZSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdlbnRlciAzJyk7XG4gICAgY29uc29sZS5sb2cocmVzdWx0KTtcblxuICAgIGlmIChyZXN1bHQpIHtcbiAgICAgIGNvbnNvbGUubG9nKCfjg63jg7zjg6vjgYLjgoo6IG5hbWUgPSAnICsgZmFtaWx5LmlkICsgJzogJyArIHJlc3VsdCk7XG4gICAgICBmYW1pbHlSb2xlID0gcmVzdWx0O1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyDml6LlrZhSb2xl44GM44Gq44GR44KM44Gw5L2c44KL44CCXG4gICAgICBmYW1pbHlSb2xlID0gbmV3IFBhcnNlLlJvbGUoZmFtaWx5LmlkLCBuZXcgUGFyc2UuQUNMKCkpO1xuICAgICAgY29uc29sZS5sb2coJ+ODreODvOODq+OBquOBlzogbmFtZSA9ICcgKyBmYW1pbHkuaWQgKyAn44KS5L2c44KK44G+44GZ44CCJyk7XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKGZhbWlseVJvbGUuZ2V0VXNlcnMoKSk7XG4gICAgZmFtaWx5Um9sZS5nZXRVc2VycygpLmFkZCh0b1VzZXIpO1xuICAgIGZhbWlseVJvbGUuZ2V0VXNlcnMoKS5hZGQoZnJvbVVzZXIpO1xuICAgIHJldHVybiBmYW1pbHlSb2xlLnNhdmUoKTtcblxuICB9KS50aGVuKChyZXN1bHQ6IFBhcnNlLlJvbGUpID0+IHtcbiAgICBjb25zb2xlLmxvZygnZW50ZXIgNCcpO1xuICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XG5cbiAgICAvLyDmib/oqo3ogIXjgajnlLPoq4vogIXjga7jgZPjganjgoLmg4XloLHjgpLlj5blvpdcbiAgICBsZXQgUGFyc2VDaGlsZCA9IFBhcnNlLk9iamVjdC5leHRlbmQoJ0NoaWxkJyk7XG4gICAgbGV0IHF1ZXJ5ID0gbmV3IFBhcnNlLlF1ZXJ5KFBhcnNlQ2hpbGQpO1xuICAgIHF1ZXJ5LmNvbnRhaW5lZEluKCdjcmVhdGVkQnknLCBbIHRvVXNlciwgZnJvbVVzZXIgXSk7XG4gICAgcmV0dXJuIHF1ZXJ5LmZpbmQoKTtcblxuICB9KS50aGVuKChwYXJzZUNoaWxkcmVuOiBQYXJzZS5PYmplY3RbXSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdwYXJzZUNoaWxkcmVuOicgKyBwYXJzZUNoaWxkcmVuKTtcblxuICAgIHZhciBwcm9taXNlcyA9IFtdO1xuXG4gICAgcGFyc2VDaGlsZHJlbi5mb3JFYWNoKChwYXJzZUNoaWxkOiBQYXJzZS5PYmplY3QpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdwYXJzZUNoaWxkOicgKyBwYXJzZUNoaWxkKTtcbiAgICAgIHZhciBjaGlsZEFDTCA9IG5ldyBQYXJzZS5BQ0woKTtcbiAgICAgIGNoaWxkQUNMLnNldFJvbGVSZWFkQWNjZXNzKGZhbWlseVJvbGUsIHRydWUpO1xuICAgICAgY2hpbGRBQ0wuc2V0Um9sZVdyaXRlQWNjZXNzKGZhbWlseVJvbGUsIHRydWUpO1xuICAgICAgcGFyc2VDaGlsZC5zZXRBQ0woY2hpbGRBQ0wpO1xuICAgIH0pO1xuICAgIHByb21pc2VzLnB1c2goUGFyc2UuT2JqZWN0LnNhdmVBbGwocGFyc2VDaGlsZHJlbikpO1xuICAgIHJldHVybiBQYXJzZS5Qcm9taXNlLndoZW4ocHJvbWlzZXMpO1xuXG4gIH0pLnRoZW4oKCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdlbnRlciA1Jyk7XG5cbiAgICAvLyDlhajmipXnqL/jgpLlj5blvpdcbiAgICBsZXQgUGFyc2VWb2ljZSA9IFBhcnNlLk9iamVjdC5leHRlbmQoJ1ZvaWNlJyk7XG4gICAgLy8gVE9ETzogJ3VzZXIn44Gn44Gq44GPJ2NyZWF0ZWRCeSfjgavjgZfjgZ/jgYTjgIJcblxuICAgIGxldCBxdWVyeSA9IG5ldyBQYXJzZS5RdWVyeShQYXJzZVZvaWNlKTtcbiAgICBxdWVyeS5jb250YWluZWRJbigndXNlcicsIFsgdG9Vc2VyLCBmcm9tVXNlciBdKTtcbiAgICByZXR1cm4gcXVlcnkuY291bnQoKTtcblxuICB9KS50aGVuKChjb3VudFJlc3VsdDogbnVtYmVyKSA9PiB7XG5cbiAgICBjb25zb2xlLmxvZygnY291bnRSZXN1bHQ6JyArIGNvdW50UmVzdWx0KTtcblxuICAgIHZhciBwcm9taXNlcyA9IFtdO1xuXG4gICAgbGV0IFBhcnNlVm9pY2UgPSBQYXJzZS5PYmplY3QuZXh0ZW5kKCdWb2ljZScpO1xuICAgIC8vIFRPRE86ICd1c2VyJ+OBp+OBquOBjydjcmVhdGVkQnkn44Gr44GX44Gf44GE44CCXG5cbiAgICBsZXQgcXVlcnkgPSBuZXcgUGFyc2UuUXVlcnkoUGFyc2VWb2ljZSk7XG4gICAgcXVlcnkuY29udGFpbmVkSW4oJ3VzZXInLCBbIHRvVXNlciwgZnJvbVVzZXIgXSk7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50UmVzdWx0IC8gMTAwMDsgaSsrKSB7XG4gICAgICBxdWVyeS5saW1pdCgxMDAwKTtcbiAgICAgIHF1ZXJ5LnNraXAoMTAwMCAqIGkpO1xuICAgICAgcHJvbWlzZXMucHVzaChxdWVyeS5maW5kKCkpO1xuICAgIH1cbiAgICByZXR1cm4gUGFyc2UuUHJvbWlzZS53aGVuKHByb21pc2VzKTtcblxuICB9KS50aGVuKCguLi52b2ljZXNBcnJheTogUGFyc2UuT2JqZWN0W11bXSkgPT4ge1xuXG4gICAgY29uc29sZS5sb2coJ3ZvaWNlczonICsgdm9pY2VzQXJyYXkpO1xuXG4gICAgdmFyIHByb21pc2VzID0gW107XG5cbiAgICB2b2ljZXNBcnJheS5mb3JFYWNoKCh2b2ljZXM6IFBhcnNlLk9iamVjdFtdKSA9PiB7XG5cbiAgICAgIHZvaWNlcy5mb3JFYWNoKCh2b2ljZTogUGFyc2UuT2JqZWN0KSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCd2b2ljZTonICsgdm9pY2UuaWQgKyAnOicgKyBmYW1pbHlSb2xlLmlkKTtcbiAgICAgICAgdmFyIHZvaWNlQUNMID0gbmV3IFBhcnNlLkFDTCgpO1xuICAgICAgICB2b2ljZUFDTC5zZXRSb2xlUmVhZEFjY2VzcyhmYW1pbHlSb2xlLCB0cnVlKTtcbiAgICAgICAgdm9pY2VBQ0wuc2V0Um9sZVdyaXRlQWNjZXNzKGZhbWlseVJvbGUsIHRydWUpO1xuXG4gICAgICAgIGlmICh2b2ljZS5nZXRBQ0woKS5nZXRQdWJsaWNSZWFkQWNjZXNzKCkpIHtcbiAgICAgICAgICB2b2ljZUFDTC5zZXRQdWJsaWNSZWFkQWNjZXNzKHRydWUpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCd2b2ljZTogc2V0UHVibGljUmVhZEFjY2VzcycpO1xuICAgICAgICB9XG4gICAgICAgIHZvaWNlLnNldEFDTCh2b2ljZUFDTCk7XG4gICAgICB9KTtcbiAgICAgIHByb21pc2VzLnB1c2goUGFyc2UuT2JqZWN0LnNhdmVBbGwodm9pY2VzKSk7XG4gICAgICByZXR1cm4gUGFyc2UuUHJvbWlzZS53aGVuKHByb21pc2VzKTtcblxuICAgIH0pO1xuXG4gIH0pLnRoZW4oKCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdlbnRlciA2Jyk7XG5cbiAgICByZXNwb25zZS5zdWNjZXNzKCdTdWNjZXNzIScpO1xuICB9LFxuICAoZXJyb3I6IFBhcnNlLkVycm9yKSA9PiB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3I6ICcgKyBlcnJvci5jb2RlICsgJyAnICsgZXJyb3IubWVzc2FnZSk7XG4gICAgcmVzcG9uc2UuZXJyb3IoJ0Vycm9yISBzZWUgbG9nIG9uIFBhcnNlLmNvbS4nKTtcbiAgfSk7XG59KTtcblxuUGFyc2UuQ2xvdWQuZGVmaW5lKCdnZXRSZXF1ZXN0VXNlcnNGYW1pbHlSb2xlJywgZnVuY3Rpb24ocmVxdWVzdDogUGFyc2UuQ2xvdWQuRnVuY3Rpb25SZXF1ZXN0LCByZXNwb25zZTogUGFyc2UuQ2xvdWQuRnVuY3Rpb25SZXNwb25zZSkge1xuXG4gIFBhcnNlLkNsb3VkLnVzZU1hc3RlcktleSgpO1xuXG4gIHZhciBmYW1pbHlRdWVyeSA9IG5ldyBQYXJzZS5RdWVyeSgnRmFtaWx5Jyk7XG4gIGZhbWlseVF1ZXJ5LmVxdWFsVG8oJ21lbWJlcicsIHJlcXVlc3QudXNlcik7XG4gIGZhbWlseVF1ZXJ5LmZpcnN0KClcbiAgLnRoZW4oKHJlc3VsdDogUGFyc2UuT2JqZWN0KSA9PiB7XG5cbiAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgdmFyIHJvbGVRdWVyeSA9IG5ldyBQYXJzZS5RdWVyeShQYXJzZS5Sb2xlKTtcbiAgICAgICAgcm9sZVF1ZXJ5LmVxdWFsVG8oJ25hbWUnLCByZXN1bHQuaWQpO1xuICAgICAgICByZXR1cm4gcm9sZVF1ZXJ5LmZpcnN0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gUGFyc2UuUHJvbWlzZS5hcyhudWxsKTtcbiAgICAgIH1cbiAgfSkudGhlbigocmVzdWx0OiBQYXJzZS5Sb2xlKSA9PiB7XG4gICAgcmVzcG9uc2Uuc3VjY2VzcyhyZXN1bHQpO1xuICB9KTtcbn0pO1xuXG5QYXJzZS5DbG91ZC5kZWZpbmUoJ2dldFJlcXVlc3RVc2Vyc0ZhbWlseU1lbWJlcicsIGZ1bmN0aW9uKHJlcXVlc3Q6IFBhcnNlLkNsb3VkLkZ1bmN0aW9uUmVxdWVzdCwgcmVzcG9uc2U6IFBhcnNlLkNsb3VkLkZ1bmN0aW9uUmVzcG9uc2UpIHtcblxuICBQYXJzZS5DbG91ZC51c2VNYXN0ZXJLZXkoKTtcblxuICB2YXIgZmFtaWx5UXVlcnkgPSBuZXcgUGFyc2UuUXVlcnkoJ0ZhbWlseScpO1xuICBmYW1pbHlRdWVyeS5jb250YWluZWRJbignbWVtYmVyJywgWyByZXF1ZXN0LnVzZXIgXSk7XG4gIGZhbWlseVF1ZXJ5LmZpcnN0KClcbiAgLnRoZW4oKHJlc3VsdDogUGFyc2UuT2JqZWN0KSA9PiB7XG4gICAgY29uc29sZS5sb2cocmVzdWx0KTtcbiAgICBpZiAocmVzdWx0KSB7XG5cbiAgICAgIHZhciBxdWVyeSA9IHJlc3VsdC5yZWxhdGlvbignbWVtYmVyJykucXVlcnkoKTtcbiAgICAgIC8vIOS7luODpuODvOOCtuOBq+i/lOWNtOOBmeOCi+OBruOBp+ODkeOCueODr+ODvOODieOBquOBqeOBr+i/lOOBleOBquOBhOOAglxuICAgICAgcXVlcnkuc2VsZWN0KCd1c2VybmFtZScsICdpY29uVXJsJyk7XG4gICAgICByZXR1cm4gcXVlcnkuZmluZCgpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgfSkudGhlbigocmVzdWx0OiBQYXJzZS5PYmplY3RbXSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XG4gICAgcmVzcG9uc2Uuc3VjY2VzcyhyZXN1bHQpO1xuICB9LFxuICAoZXJyb3I6IFBhcnNlLkVycm9yKSA9PiB7XG4gICAgcmVzcG9uc2UuZXJyb3IoZXJyb3IpO1xuICB9KTtcbn0pO1xuXG5QYXJzZS5DbG91ZC5kZWZpbmUoJ2dldEZhbWlseUFwcFRvUmVxdWVzdFVzZXInLCBmdW5jdGlvbihyZXF1ZXN0OiBQYXJzZS5DbG91ZC5GdW5jdGlvblJlcXVlc3QsIHJlc3BvbnNlOiBQYXJzZS5DbG91ZC5GdW5jdGlvblJlc3BvbnNlKSB7XG5cbiAgUGFyc2UuQ2xvdWQudXNlTWFzdGVyS2V5KCk7XG5cbiAgdmFyIFBhcnNlRmFtaWx5QXBwbGljYXRpb24gPSBQYXJzZS5PYmplY3QuZXh0ZW5kKCdGYW1pbHlBcHBsaWNhdGlvbicpO1xuICB2YXIgcXVlcnkgPSBuZXcgUGFyc2UuUXVlcnkoUGFyc2VGYW1pbHlBcHBsaWNhdGlvbik7XG4gIHF1ZXJ5LmRlc2NlbmRpbmcoJ2NyZWF0ZWRBdCcpO1xuICAvLyDoh6rliIblrpvjgaZcbiAgcXVlcnkuZXF1YWxUbygndG9Vc2VyJywgcmVxdWVzdC51c2VyKTtcbiAgcXVlcnkuaW5jbHVkZSgnZnJvbVVzZXInKTtcbiAgcXVlcnkuZmluZCgpXG4gIC50aGVuKChyZXN1bHQ6IFBhcnNlLk9iamVjdFtdKSA9PiB7XG4gICAgcmVzcG9uc2Uuc3VjY2VzcyhyZXN1bHQpO1xuICB9LFxuICAoZXJyb3I6IFBhcnNlLkVycm9yKSA9PiB7XG4gICAgcmVzcG9uc2UuZXJyb3IoZXJyb3IpO1xuICB9KTtcbn0pO1xuXG5QYXJzZS5DbG91ZC5kZWZpbmUoJ2dldENvdW50T2ZGYW1pbHlBcHBUb1JlcXVlc3RVc2VyJywgZnVuY3Rpb24ocmVxdWVzdDogUGFyc2UuQ2xvdWQuRnVuY3Rpb25SZXF1ZXN0LCByZXNwb25zZTogUGFyc2UuQ2xvdWQuRnVuY3Rpb25SZXNwb25zZSkge1xuXG4gIFBhcnNlLkNsb3VkLnVzZU1hc3RlcktleSgpO1xuXG4gIHZhciBQYXJzZUZhbWlseUFwcGxpY2F0aW9uID0gUGFyc2UuT2JqZWN0LmV4dGVuZCgnRmFtaWx5QXBwbGljYXRpb24nKTtcbiAgdmFyIHF1ZXJ5ID0gbmV3IFBhcnNlLlF1ZXJ5KFBhcnNlRmFtaWx5QXBwbGljYXRpb24pO1xuICBxdWVyeS5kZXNjZW5kaW5nKCdjcmVhdGVkQXQnKTtcbiAgLy8g6Ieq5YiG5a6b44GmXG4gIHF1ZXJ5LmVxdWFsVG8oJ3RvVXNlcicsIHJlcXVlc3QudXNlcik7XG4gIHF1ZXJ5LmluY2x1ZGUoJ2Zyb21Vc2VyJyk7XG4gIHF1ZXJ5LmNvdW50KClcbiAgLnRoZW4oKGNvdW50OiBudW1iZXIpID0+IHtcbiAgICByZXNwb25zZS5zdWNjZXNzKGNvdW50KTtcbiAgfSxcbiAgKGVycm9yOiBQYXJzZS5FcnJvcikgPT4ge1xuICAgIHJlc3BvbnNlLmVycm9yKGVycm9yKTtcbiAgfSk7XG59KTtcblxuUGFyc2UuQ2xvdWQuZGVmaW5lKCdnZXRGYW1pbHlBcHBGcm9tUmVxdWVzdFVzZXInLCBmdW5jdGlvbihyZXF1ZXN0OiBQYXJzZS5DbG91ZC5GdW5jdGlvblJlcXVlc3QsIHJlc3BvbnNlOiBQYXJzZS5DbG91ZC5GdW5jdGlvblJlc3BvbnNlKSB7XG5cbiAgUGFyc2UuQ2xvdWQudXNlTWFzdGVyS2V5KCk7XG5cbiAgdmFyIFBhcnNlRmFtaWx5QXBwbGljYXRpb24gPSBQYXJzZS5PYmplY3QuZXh0ZW5kKCdGYW1pbHlBcHBsaWNhdGlvbicpO1xuICB2YXIgcXVlcnkgPSBuZXcgUGFyc2UuUXVlcnkoUGFyc2VGYW1pbHlBcHBsaWNhdGlvbik7XG4gIHF1ZXJ5LmRlc2NlbmRpbmcoJ2NyZWF0ZWRBdCcpO1xuICAvLyDoh6rliIblrpvjgaZcbiAgcXVlcnkuZXF1YWxUbygnZnJvbVVzZXInLCByZXF1ZXN0LnVzZXIpO1xuICBxdWVyeS5pbmNsdWRlKCdmcm9tVXNlcicpO1xuICBxdWVyeS5pbmNsdWRlKCd0b1VzZXInKTtcbiAgcXVlcnkuZmluZCgpXG4gIC50aGVuKChyZXN1bHQ6IFBhcnNlLk9iamVjdFtdKSA9PiB7XG4gICAgcmVzcG9uc2Uuc3VjY2VzcyhyZXN1bHQpO1xuICB9LFxuICAoZXJyb3I6IFBhcnNlLkVycm9yKSA9PiB7XG4gICAgcmVzcG9uc2UuZXJyb3IoZXJyb3IpO1xuICB9KTtcbn0pO1xuXG52YXIgUGFyc2VJbWFnZTogYW55ID0gcmVxdWlyZSgncGFyc2UtaW1hZ2UnKTtcblxuLypcbiAqIOODl+ODreODleOCo+ODvOODq+S/neWtmOaZguOBq+eUu+WDj+OCkjE2MHB444Gr44Oq44K144Kk44K6XG4gKi9cblBhcnNlLkNsb3VkLmJlZm9yZVNhdmUoJ19Vc2VyJywgKHJlcXVlc3Q6IFBhcnNlLkNsb3VkLkJlZm9yZVNhdmVSZXF1ZXN0LCByZXNwb25zZTogUGFyc2UuQ2xvdWQuQmVmb3JlU2F2ZVJlc3BvbnNlKSA9PiB7XG5cbiAgdmFyIHVzZXIgPSByZXF1ZXN0Lm9iamVjdDtcbiAgaWYgKCF1c2VyLmdldCgnaWNvbicpKSB7XG4gICAgcmVzcG9uc2Uuc3VjY2Vzcyh1c2VyKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoIXVzZXIuZGlydHkoJ2ljb24nKSkge1xuICAgIC8vIC5UaGUgcHJvZmlsZSBwaG90byBpc24ndCBiZWluZyBtb2RpZmllZC5cbiAgICByZXNwb25zZS5zdWNjZXNzKHVzZXIpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIFBhcnNlLkNsb3VkLmh0dHBSZXF1ZXN0KHtcbiAgICAvLyBfVXNlcuOBrmJlZm9yZVNhdmXjgarjga7jgafjgIFpY29uVXJs44Gv44G+44Gg5pu05paw44GV44KM44Gm44GE44Gq44GE44Gu44GnaWNvbi51cmwoKeOCkuS9v+OBhuOAglxuICAgIHVybDogdXNlci5nZXQoJ2ljb24nKS51cmwoKVxuXG4gIH0pLnRoZW4oKHJlc3BvbnNlOiBQYXJzZS5DbG91ZC5IdHRwUmVzcG9uc2UpID0+IHtcbiAgICBjb25zb2xlLmxvZygzKTtcbiAgICB2YXIgaW1hZ2UgPSBuZXcgUGFyc2VJbWFnZSgpO1xuICAgIHJldHVybiBpbWFnZS5zZXREYXRhKHJlc3BvbnNlLmJ1ZmZlcik7XG5cbiAgfSkudGhlbigoaW1hZ2U6IGFueSkgPT4ge1xuICAgIC8vIC5Dcm9wIHRoZSBpbWFnZSB0byB0aGUgc21hbGxlciBvZiB3aWR0aCBvciBoZWlnaHQuXG4gICAgdmFyIHNpemUgPSBNYXRoLm1pbihpbWFnZS53aWR0aCgpLCBpbWFnZS5oZWlnaHQoKSk7XG4gICAgcmV0dXJuIGltYWdlLmNyb3Aoe1xuICAgICAgbGVmdDogKGltYWdlLndpZHRoKCkgLSBzaXplKSAvIDIsXG4gICAgICB0b3A6IChpbWFnZS5oZWlnaHQoKSAtIHNpemUpIC8gMixcbiAgICAgIHdpZHRoOiBzaXplLFxuICAgICAgaGVpZ2h0OiBzaXplXG4gICAgfSk7XG5cbiAgfSkudGhlbigoaW1hZ2U6IGFueSkgPT4ge1xuICAgIC8vIC5SZXNpemUgdGhlIGltYWdlIHRvIDY0eDY0LlxuICAgIHJldHVybiBpbWFnZS5zY2FsZSh7XG4gICAgICB3aWR0aDogMTYwLFxuICAgICAgaGVpZ2h0OiAxNjBcbiAgICB9KTtcblxuICB9KS50aGVuKChpbWFnZTogYW55KSA9PiB7XG4gICAgLy8gLk1ha2Ugc3VyZSBpdCdzIGEgSlBFRyB0byBzYXZlIGRpc2sgc3BhY2UgYW5kIGJhbmR3aWR0aC5cbiAgICByZXR1cm4gaW1hZ2Uuc2V0Rm9ybWF0KCdKUEVHJyk7XG5cbiAgfSkudGhlbigoaW1hZ2U6IGFueSkgPT4ge1xuICAgIC8vIC5HZXQgdGhlIGltYWdlIGRhdGEgaW4gYSBCdWZmZXIuXG4gICAgcmV0dXJuIGltYWdlLmRhdGEoKTtcblxuICB9KS50aGVuKChidWZmZXI6IGFueSkgPT4ge1xuICAgIC8vIC5TYXZlIHRoZSBpbWFnZSBpbnRvIGEgbmV3IGZpbGUuXG4gICAgdmFyIGJhc2U2NCA9IGJ1ZmZlci50b1N0cmluZygnYmFzZTY0Jyk7XG4gICAgdmFyIGNyb3BwZWQgPSBuZXcgUGFyc2UuRmlsZSgncGhvdG8uanBnJywgeyBiYXNlNjQ6IGJhc2U2NCB9KTtcbiAgICByZXR1cm4gY3JvcHBlZC5zYXZlKCk7XG5cbiAgfSkudGhlbigoY3JvcHBlZDogYW55KSA9PiB7XG4gICAgLy8gLkF0dGFjaCB0aGUgaW1hZ2UgZmlsZSB0byB0aGUgb3JpZ2luYWwgb2JqZWN0LlxuICAgIHVzZXIuc2V0KCdpY29uJywgY3JvcHBlZCk7XG4gICAgdXNlci5zZXQoJ2ljb25VcmwnLCBjcm9wcGVkLnVybCgpKTtcblxuICB9KS50aGVuKCgpID0+IHtcbiAgICByZXNwb25zZS5zdWNjZXNzKHVzZXIpO1xuICB9LCAoZXJyb3I6IFBhcnNlLkVycm9yKSA9PiB7XG4gICAgY29uc29sZS5sb2coOSk7XG4gICAgcmVzcG9uc2UuZXJyb3IoZXJyb3IpO1xuICB9KTtcbn0pO1xuXG4vKlxuICog5oqV56i/44Gr55S75YOP44KSNDgwcHjjgavjg6rjgrXjgqTjgrpcbiAqL1xuUGFyc2UuQ2xvdWQuYmVmb3JlU2F2ZSgnVm9pY2UnLCAocmVxdWVzdDogUGFyc2UuQ2xvdWQuQmVmb3JlU2F2ZVJlcXVlc3QsIHJlc3BvbnNlOiBQYXJzZS5DbG91ZC5CZWZvcmVTYXZlUmVzcG9uc2UpID0+IHtcbiAgdmFyIHZvaWNlID0gcmVxdWVzdC5vYmplY3Q7XG4gIGlmICghdm9pY2UuZ2V0KCdwaG90bycpKSB7XG4gICAgcmVzcG9uc2Uuc3VjY2Vzcyh2b2ljZSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKCF2b2ljZS5kaXJ0eSgncGhvdG8nKSkge1xuICAgIC8vIC5UaGUgcHJvZmlsZSBwaG90byBpc24ndCBiZWluZyBtb2RpZmllZC5cbiAgICByZXNwb25zZS5zdWNjZXNzKHZvaWNlKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBQYXJzZS5DbG91ZC5odHRwUmVxdWVzdCh7XG4gICAgLy8gLlZvaWNl44GuYmVmb3JlU2F2ZeOBquOBruOBp+OAgXBob3RvVXJs44Gv44G+44Gg5pu05paw44GV44KM44Gm44GE44Gq44GE44Gu44GncGhvdG8udXJsKCnjgpLkvb/jgYbjgIJcbiAgICB1cmw6IHZvaWNlLmdldCgncGhvdG8nKS51cmwoKVxuXG4gIH0pLnRoZW4oKHJlc3BvbnNlOiBQYXJzZS5DbG91ZC5IdHRwUmVzcG9uc2UpID0+IHtcbiAgICBjb25zb2xlLmxvZygnYmVmb3JlIHNhdmUgdm9pY2U6IDQnKVxuICAgIHZhciBpbWFnZSA9IG5ldyBQYXJzZUltYWdlKCk7XG4gICAgcmV0dXJuIGltYWdlLnNldERhdGEocmVzcG9uc2UuYnVmZmVyKTtcblxuICB9KS50aGVuKChpbWFnZTogYW55KSA9PiB7XG4gICAgLy8gLlJlc2l6ZSB0aGUgaW1hZ2UgdG8gNjR4NjQuXG4gICAgdmFyIHNjYWxlID0gNDgwIC8gTWF0aC5tYXgoaW1hZ2Uud2lkdGgoKSwgaW1hZ2UuaGVpZ2h0KCkpO1xuICAgIHJldHVybiBpbWFnZS5zY2FsZSh7XG4gICAgICB3aWR0aDogaW1hZ2Uud2lkdGgoKSAqIHNjYWxlLFxuICAgICAgaGVpZ2h0OiBpbWFnZS5oZWlnaHQoKSAqIHNjYWxlXG4gICAgfSk7XG5cbiAgfSkudGhlbigoaW1hZ2U6IGFueSkgPT4ge1xuICAgIC8vIC5NYWtlIHN1cmUgaXQncyBhIEpQRUcgdG8gc2F2ZSBkaXNrIHNwYWNlIGFuZCBiYW5kd2lkdGguXG4gICAgcmV0dXJuIGltYWdlLnNldEZvcm1hdCgnSlBFRycpO1xuXG4gIH0pLnRoZW4oKGltYWdlOiBhbnkpID0+IHtcbiAgICAvLyAuR2V0IHRoZSBpbWFnZSBkYXRhIGluIGEgQnVmZmVyLlxuICAgIHJldHVybiBpbWFnZS5kYXRhKCk7XG5cbiAgfSkudGhlbigoYnVmZmVyOiBhbnkpID0+IHtcbiAgICAvLyAuU2F2ZSB0aGUgaW1hZ2UgaW50byBhIG5ldyBmaWxlLlxuICAgIHZhciBiYXNlNjQgPSBidWZmZXIudG9TdHJpbmcoJ2Jhc2U2NCcpO1xuICAgIHZhciBjcm9wcGVkID0gbmV3IFBhcnNlLkZpbGUoJ3Bob3RvLmpwZycsIHsgYmFzZTY0OiBiYXNlNjQgfSk7XG4gICAgcmV0dXJuIGNyb3BwZWQuc2F2ZSgpO1xuXG4gIH0pLnRoZW4oKGNyb3BwZWQ6IGFueSkgPT4ge1xuICAgIC8vIC5BdHRhY2ggdGhlIGltYWdlIGZpbGUgdG8gdGhlIG9yaWdpbmFsIG9iamVjdC5cbiAgICB2b2ljZS5zZXQoJ3Bob3RvJywgY3JvcHBlZCk7XG4gICAgdm9pY2Uuc2V0KCdwaG90b1VybCcsIGNyb3BwZWQudXJsKCkpO1xuXG4gIH0pLnRoZW4oKCkgPT4ge1xuICAgIHJlc3BvbnNlLnN1Y2Nlc3Modm9pY2UpO1xuICB9LCAoZXJyb3I6IFBhcnNlLkVycm9yKSA9PiB7XG4gICAgY29uc29sZS5sb2coOSk7XG4gICAgcmVzcG9uc2UuZXJyb3IoZXJyb3IpO1xuICB9KTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9