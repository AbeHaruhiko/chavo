/// <reference path='../../../.tmp/typings/tsd.d.ts' />
Parse.Cloud.define('hello', function (request, response) {
    response.success('Hello world!');
});
Parse.Cloud.define('toggleLike', function (request, response) {
    // 人のvoiceのlikceCountをincrementするのでuseMasterKey
    Parse.Cloud.useMasterKey();
    var voice = request.params.voice;
    // ↓のトグルはローカルで実施済み
    // voice.like = !voice.like;
    var ParseVoice = Parse.Object.extend('Voice');
    var parseVoice = new ParseVoice();
    parseVoice.id = voice.objectId;
    if (voice.like) {
        request.user.addUnique('likes', voice.objectId);
        parseVoice.increment('likeCount');
    }
    else {
        request.user.remove('likes', voice.objectId);
        parseVoice.increment('likeCount', -1);
    }
    request.user.save()
        .then(function (user) {
        console.log('user: ' + user);
        console.log('likes: ' + user.get('likes'));
        return parseVoice.save();
    })
        .then(function (parseVoice) {
        console.log('likeCound: ' + parseVoice.get('likeCount'));
        response.success(parseVoice.get('likeCount'));
    }, function (error) {
        console.error('Error: ' + error.code + ' ' + error.message);
        response.error('Error: ' + error.code + ' ' + error.message);
    });
});
Parse.Cloud.define('saveTag', function (request, response) {
    var tags = request.params.tags;
    tags.forEach(function (tag) {
        console.log(tag);
        var ParseTag = Parse.Object.extend('Tag');
        var query = new Parse.Query(ParseTag);
        query.equalTo('tag', tag);
        query.count().then(function (count) {
            console.log('count: ' + count);
            if (count === 0) {
                var parseTag = new ParseTag();
                parseTag.set('tag', tag);
                return parseTag.save();
            }
        })
            .then(function (parseTag) {
            if (parseTag) {
                console.log('saved tag: ' + parseTag.get('tag'));
            }
            response.success(null);
        });
    });
});
Parse.Cloud.define('addFamily', function (request, response) {
    // 人のChildを共有するようにACLを編集したりRoleを作ったりするのでマスターキー使用。
    Parse.Cloud.useMasterKey();
    // toUserIdかfromUserIdの家族を表すRoleがあるか
    var toUser = new Parse.User();
    var fromUser = new Parse.User();
    // 申請先ユーザ（承認者）
    toUser.id = request.user.id;
    // 申請元ユーザ（申請者）
    fromUser.id = request.params.familyApplication.fromUserObjectId;
    // 申請者、承認者のFamilyデータを検索する。
    var familyQuery = new Parse.Query('Family');
    familyQuery.containedIn('member', [request.user, fromUser]);
    var family;
    var familyRole;
    familyQuery.first()
        .then(function (family) {
        console.log('enter 1');
        console.log(family);
        if (!family) {
            console.log('既存familyなし');
            // 既存のFamilyがないので作る。
            var ParseFamily = Parse.Object.extend('Family');
            family = new ParseFamily();
            family.setACL(new Parse.ACL());
        }
        var relation = family.relation('member');
        relation.add(toUser);
        relation.add(fromUser);
        return family.save();
    }).then(function (result) {
        console.log('enter 2');
        console.log(result);
        family = result;
        // .FamilyのオブジェクトIDをnameに持つRoleを探す。
        var familyRoleQuery = new Parse.Query(Parse.Role);
        console.log(result.id);
        familyRoleQuery.equalTo('name', result.id);
        return familyRoleQuery.first();
    }).then(function (result) {
        console.log('enter 3');
        console.log(result);
        if (result) {
            console.log('ロールあり: name = ' + family.id + ': ' + result);
            familyRole = result;
        }
        else {
            // 既存Roleがなければ作る。
            familyRole = new Parse.Role(family.id, new Parse.ACL());
            console.log('ロールなし: name = ' + family.id + 'を作ります。');
        }
        console.log(familyRole.getUsers());
        familyRole.getUsers().add(toUser);
        familyRole.getUsers().add(fromUser);
        return familyRole.save();
    }).then(function (result) {
        console.log('enter 4');
        console.log(result);
        // 承認者と申請者のこども情報を取得
        var ParseChild = Parse.Object.extend('Child');
        var query = new Parse.Query(ParseChild);
        query.containedIn('createdBy', [toUser, fromUser]);
        return query.find();
    }).then(function (parseChildren) {
        console.log('parseChildren:' + parseChildren);
        var promises = [];
        parseChildren.forEach(function (parseChild) {
            console.log('parseChild:' + parseChild);
            var childACL = new Parse.ACL();
            childACL.setRoleReadAccess(familyRole, true);
            childACL.setRoleWriteAccess(familyRole, true);
            parseChild.setACL(childACL);
        });
        promises.push(Parse.Object.saveAll(parseChildren));
        return Parse.Promise.when(promises);
    }).then(function () {
        console.log('enter 5');
        // 全投稿を取得
        var ParseVoice = Parse.Object.extend('Voice');
        // TODO: 'user'でなく'createdBy'にしたい。
        var query = new Parse.Query(ParseVoice);
        query.containedIn('user', [toUser, fromUser]);
        return query.count();
    }).then(function (countResult) {
        console.log('countResult:' + countResult);
        var promises = [];
        var ParseVoice = Parse.Object.extend('Voice');
        // TODO: 'user'でなく'createdBy'にしたい。
        var query = new Parse.Query(ParseVoice);
        query.containedIn('user', [toUser, fromUser]);
        for (var i = 0; i < countResult / 1000; i++) {
            query.limit(1000);
            query.skip(1000 * i);
            promises.push(query.find());
        }
        return Parse.Promise.when(promises);
    }).then(function () {
        var voicesArray = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            voicesArray[_i - 0] = arguments[_i];
        }
        console.log('voices:' + voicesArray);
        var promises = [];
        voicesArray.forEach(function (voices) {
            voices.forEach(function (voice) {
                console.log('voice:' + voice.id + ':' + familyRole.id);
                var voiceACL = new Parse.ACL();
                voiceACL.setRoleReadAccess(familyRole, true);
                voiceACL.setRoleWriteAccess(familyRole, true);
                if (voice.getACL().getPublicReadAccess()) {
                    voiceACL.setPublicReadAccess(true);
                    console.log('voice: setPublicReadAccess');
                }
                voice.setACL(voiceACL);
            });
            promises.push(Parse.Object.saveAll(voices));
            return Parse.Promise.when(promises);
        });
    }).then(function () {
        console.log('enter 6');
        response.success('Success!');
    }, function (error) {
        console.error('Error: ' + error.code + ' ' + error.message);
        response.error('Error! see log on Parse.com.');
    });
});
Parse.Cloud.define('getRequestUsersFamilyRole', function (request, response) {
    Parse.Cloud.useMasterKey();
    var familyQuery = new Parse.Query('Family');
    familyQuery.equalTo('member', request.user);
    familyQuery.first()
        .then(function (result) {
        if (result) {
            var roleQuery = new Parse.Query(Parse.Role);
            roleQuery.equalTo('name', result.id);
            return roleQuery.first();
        }
        else {
            return Parse.Promise.as(null);
        }
    }).then(function (result) {
        response.success(result);
    });
});
Parse.Cloud.define('getRequestUsersFamilyMember', function (request, response) {
    Parse.Cloud.useMasterKey();
    var familyQuery = new Parse.Query('Family');
    familyQuery.containedIn('member', [request.user]);
    familyQuery.first()
        .then(function (result) {
        console.log(result);
        if (result) {
            var query = result.relation('member').query();
            // 他ユーザに返却するのでパスワードなどは返さない。
            query.select('username', 'iconUrl');
            return query.find();
        }
        else {
            return;
        }
    }).then(function (result) {
        console.log(result);
        response.success(result);
    }, function (error) {
        response.error(error);
    });
});
Parse.Cloud.define('getFamilyAppToRequestUser', function (request, response) {
    Parse.Cloud.useMasterKey();
    var ParseFamilyApplication = Parse.Object.extend('FamilyApplication');
    var query = new Parse.Query(ParseFamilyApplication);
    query.descending('createdAt');
    // 自分宛て
    query.equalTo('toUser', request.user);
    query.include('fromUser');
    query.find()
        .then(function (result) {
        response.success(result);
    }, function (error) {
        response.error(error);
    });
});
Parse.Cloud.define('getCountOfFamilyAppToRequestUser', function (request, response) {
    Parse.Cloud.useMasterKey();
    var ParseFamilyApplication = Parse.Object.extend('FamilyApplication');
    var query = new Parse.Query(ParseFamilyApplication);
    query.descending('createdAt');
    // 自分宛て
    query.equalTo('toUser', request.user);
    query.include('fromUser');
    query.count()
        .then(function (count) {
        response.success(count);
    }, function (error) {
        response.error(error);
    });
});
Parse.Cloud.define('getFamilyAppFromRequestUser', function (request, response) {
    Parse.Cloud.useMasterKey();
    var ParseFamilyApplication = Parse.Object.extend('FamilyApplication');
    var query = new Parse.Query(ParseFamilyApplication);
    query.descending('createdAt');
    // 自分宛て
    query.equalTo('fromUser', request.user);
    query.include('fromUser');
    query.include('toUser');
    query.find()
        .then(function (result) {
        response.success(result);
    }, function (error) {
        response.error(error);
    });
});
var ParseImage = require('parse-image');
/*
 * プロフィール保存時に画像を160pxにリサイズ
 */
Parse.Cloud.beforeSave('_User', function (request, response) {
    var user = request.object;
    if (!user.get('icon')) {
        response.success(user);
        return;
    }
    if (!user.dirty('icon')) {
        // .The profile photo isn't being modified.
        response.success(user);
        return;
    }
    Parse.Cloud.httpRequest({
        // _UserのbeforeSaveなので、iconUrlはまだ更新されていないのでicon.url()を使う。
        url: user.get('icon').url()
    }).then(function (response) {
        console.log(3);
        var image = new ParseImage();
        return image.setData(response.buffer);
    }).then(function (image) {
        // .Crop the image to the smaller of width or height.
        var size = Math.min(image.width(), image.height());
        return image.crop({
            left: (image.width() - size) / 2,
            top: (image.height() - size) / 2,
            width: size,
            height: size
        });
    }).then(function (image) {
        // .Resize the image to 64x64.
        return image.scale({
            width: 160,
            height: 160
        });
    }).then(function (image) {
        // .Make sure it's a JPEG to save disk space and bandwidth.
        return image.setFormat('JPEG');
    }).then(function (image) {
        // .Get the image data in a Buffer.
        return image.data();
    }).then(function (buffer) {
        // .Save the image into a new file.
        var base64 = buffer.toString('base64');
        var cropped = new Parse.File('photo.jpg', { base64: base64 });
        return cropped.save();
    }).then(function (cropped) {
        // .Attach the image file to the original object.
        user.set('icon', cropped);
        user.set('iconUrl', cropped.url());
    }).then(function () {
        response.success(user);
    }, function (error) {
        console.log(9);
        response.error(error);
    });
});
/*
 * 投稿に画像を480pxにリサイズ
 */
Parse.Cloud.beforeSave('Voice', function (request, response) {
    var voice = request.object;
    if (!voice.get('photo')) {
        response.success(voice);
        return;
    }
    if (!voice.dirty('photo')) {
        // .The profile photo isn't being modified.
        response.success(voice);
        return;
    }
    Parse.Cloud.httpRequest({
        // .VoiceのbeforeSaveなので、photoUrlはまだ更新されていないのでphoto.url()を使う。
        url: voice.get('photo').url()
    }).then(function (response) {
        console.log('before save voice: 4');
        var image = new ParseImage();
        return image.setData(response.buffer);
    }).then(function (image) {
        // .Resize the image to 64x64.
        var scale = 480 / Math.max(image.width(), image.height());
        return image.scale({
            width: image.width() * scale,
            height: image.height() * scale
        });
    }).then(function (image) {
        // .Make sure it's a JPEG to save disk space and bandwidth.
        return image.setFormat('JPEG');
    }).then(function (image) {
        // .Get the image data in a Buffer.
        return image.data();
    }).then(function (buffer) {
        // .Save the image into a new file.
        var base64 = buffer.toString('base64');
        var cropped = new Parse.File('photo.jpg', { base64: base64 });
        return cropped.save();
    }).then(function (cropped) {
        // .Attach the image file to the original object.
        voice.set('photo', cropped);
        voice.set('photoUrl', cropped.url());
    }).then(function () {
        response.success(voice);
    }, function (error) {
        console.log(9);
        response.error(error);
    });
});

//# sourceMappingURL=data:application/json;base64,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QUFDLElBQUksQ0FBQyxVQUFDLEtBQVU7UUFDakIsMkRBQTJEO1FBQzNELE1BQU0sQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBRWpDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFDLEtBQVU7UUFDakIsbUNBQW1DO1FBQ25DLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7SUFFdEIsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsTUFBVztRQUNsQixtQ0FBbUM7UUFDbkMsSUFBSSxNQUFNLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN2QyxJQUFJLE9BQU8sR0FBRyxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7UUFDOUQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUV4QixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQyxPQUFZO1FBQ25CLGlEQUFpRDtRQUNqRCxLQUFLLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztRQUM1QixLQUFLLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUV2QyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDTixRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzFCLENBQUMsRUFBRSxVQUFDLEtBQWtCO1FBQ3BCLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDZixRQUFRLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3hCLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoiY2xvdWQvbWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9Jy4uLy4uLy4uLy50bXAvdHlwaW5ncy90c2QuZC50cycgLz5cblxuUGFyc2UuQ2xvdWQuZGVmaW5lKCdoZWxsbycsIGZ1bmN0aW9uKHJlcXVlc3Q6IFBhcnNlLkNsb3VkLkZ1bmN0aW9uUmVxdWVzdCwgcmVzcG9uc2U6IFBhcnNlLkNsb3VkLkZ1bmN0aW9uUmVzcG9uc2UpIHtcbiAgcmVzcG9uc2Uuc3VjY2VzcygnSGVsbG8gd29ybGQhJyk7XG59KTtcblxuUGFyc2UuQ2xvdWQuZGVmaW5lKCd0b2dnbGVMaWtlJywgZnVuY3Rpb24ocmVxdWVzdDogUGFyc2UuQ2xvdWQuRnVuY3Rpb25SZXF1ZXN0LCByZXNwb25zZTogUGFyc2UuQ2xvdWQuRnVuY3Rpb25SZXNwb25zZSkge1xuXG4gIC8vIOS6uuOBrnZvaWNl44GubGlrY2VDb3VudOOCkmluY3JlbWVudOOBmeOCi+OBruOBp3VzZU1hc3RlcktleVxuICBQYXJzZS5DbG91ZC51c2VNYXN0ZXJLZXkoKTtcbiAgdmFyIHZvaWNlID0gcmVxdWVzdC5wYXJhbXMudm9pY2U7XG4gIC8vIOKGk+OBruODiOOCsOODq+OBr+ODreODvOOCq+ODq+OBp+Wun+aWvea4iOOBv1xuICAvLyB2b2ljZS5saWtlID0gIXZvaWNlLmxpa2U7XG5cbiAgdmFyIFBhcnNlVm9pY2UgPSBQYXJzZS5PYmplY3QuZXh0ZW5kKCdWb2ljZScpO1xuICB2YXIgcGFyc2VWb2ljZSA9IG5ldyBQYXJzZVZvaWNlKCk7XG4gIHBhcnNlVm9pY2UuaWQgPSB2b2ljZS5vYmplY3RJZDtcblxuICBpZiAodm9pY2UubGlrZSkge1xuICAgIHJlcXVlc3QudXNlci5hZGRVbmlxdWUoJ2xpa2VzJywgdm9pY2Uub2JqZWN0SWQpO1xuICAgIHBhcnNlVm9pY2UuaW5jcmVtZW50KCdsaWtlQ291bnQnKTtcbiAgfSBlbHNlIHtcbiAgICByZXF1ZXN0LnVzZXIucmVtb3ZlKCdsaWtlcycsIHZvaWNlLm9iamVjdElkKTtcbiAgICBwYXJzZVZvaWNlLmluY3JlbWVudCgnbGlrZUNvdW50JywgLTEpO1xuICB9XG5cbiAgcmVxdWVzdC51c2VyLnNhdmUoKVxuICAudGhlbigodXNlcjogUGFyc2UuVXNlcikgPT4ge1xuICAgIGNvbnNvbGUubG9nKCd1c2VyOiAnICsgdXNlcik7XG4gICAgY29uc29sZS5sb2coJ2xpa2VzOiAnICsgdXNlci5nZXQoJ2xpa2VzJykpO1xuICAgIHJldHVybiBwYXJzZVZvaWNlLnNhdmUoKTtcbiAgfSlcbiAgLnRoZW4oKHBhcnNlVm9pY2U6IFBhcnNlLk9iamVjdCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdsaWtlQ291bmQ6ICcgKyBwYXJzZVZvaWNlLmdldCgnbGlrZUNvdW50JykpO1xuICAgIHJlc3BvbnNlLnN1Y2Nlc3MocGFyc2VWb2ljZS5nZXQoJ2xpa2VDb3VudCcpKTtcbiAgfSxcbiAgKGVycm9yOiBQYXJzZS5FcnJvcikgPT4ge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yOiAnICsgZXJyb3IuY29kZSArICcgJyArIGVycm9yLm1lc3NhZ2UpO1xuICAgIHJlc3BvbnNlLmVycm9yKCdFcnJvcjogJyArIGVycm9yLmNvZGUgKyAnICcgKyBlcnJvci5tZXNzYWdlKTtcbiAgfSk7XG5cbn0pO1xuXG5QYXJzZS5DbG91ZC5kZWZpbmUoJ3NhdmVUYWcnLCBmdW5jdGlvbihyZXF1ZXN0OiBQYXJzZS5DbG91ZC5GdW5jdGlvblJlcXVlc3QsIHJlc3BvbnNlOiBQYXJzZS5DbG91ZC5GdW5jdGlvblJlc3BvbnNlKSB7XG4gIHZhciB0YWdzOiBzdHJpbmdbXSA9IHJlcXVlc3QucGFyYW1zLnRhZ3M7XG5cbiAgdGFncy5mb3JFYWNoKCh0YWc6IHN0cmluZykgPT4ge1xuICAgIGNvbnNvbGUubG9nKHRhZyk7XG4gICAgdmFyIFBhcnNlVGFnID0gUGFyc2UuT2JqZWN0LmV4dGVuZCgnVGFnJyk7XG5cbiAgICB2YXIgcXVlcnkgPSBuZXcgUGFyc2UuUXVlcnkoUGFyc2VUYWcpO1xuICAgIHF1ZXJ5LmVxdWFsVG8oJ3RhZycsIHRhZyk7XG4gICAgcXVlcnkuY291bnQoKS50aGVuKChjb3VudDogbnVtYmVyKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygnY291bnQ6ICcgKyBjb3VudCk7XG4gICAgICBpZiAoY291bnQgPT09IDApIHtcbiAgICAgICAgdmFyIHBhcnNlVGFnID0gbmV3IFBhcnNlVGFnKCk7XG4gICAgICAgIHBhcnNlVGFnLnNldCgndGFnJywgdGFnKTtcbiAgICAgICAgcmV0dXJuIHBhcnNlVGFnLnNhdmUoKTtcbiAgICAgIH1cbiAgICB9KVxuICAgIC50aGVuKChwYXJzZVRhZzogUGFyc2UuT2JqZWN0KSA9PiB7XG4gICAgICBpZiAocGFyc2VUYWcpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3NhdmVkIHRhZzogJyArIHBhcnNlVGFnLmdldCgndGFnJykpO1xuICAgICAgfVxuICAgICAgcmVzcG9uc2Uuc3VjY2VzcyhudWxsKTtcbiAgICB9KTtcbiAgfSk7XG5cbn0pO1xuXG5QYXJzZS5DbG91ZC5kZWZpbmUoJ2FkZEZhbWlseScsIGZ1bmN0aW9uKHJlcXVlc3Q6IFBhcnNlLkNsb3VkLkZ1bmN0aW9uUmVxdWVzdCwgcmVzcG9uc2U6IFBhcnNlLkNsb3VkLkZ1bmN0aW9uUmVzcG9uc2UpIHtcblxuICAvLyDkurrjga5DaGlsZOOCkuWFseacieOBmeOCi+OCiOOBhuOBq0FDTOOCkue3qOmbhuOBl+OBn+OCilJvbGXjgpLkvZzjgaPjgZ/jgorjgZnjgovjga7jgafjg57jgrnjgr/jg7zjgq3jg7zkvb/nlKjjgIJcbiAgUGFyc2UuQ2xvdWQudXNlTWFzdGVyS2V5KCk7XG5cbiAgLy8gdG9Vc2VySWTjgYtmcm9tVXNlcklk44Gu5a625peP44KS6KGo44GZUm9sZeOBjOOBguOCi+OBi1xuICB2YXIgdG9Vc2VyID0gbmV3IFBhcnNlLlVzZXIoKTtcbiAgdmFyIGZyb21Vc2VyID0gbmV3IFBhcnNlLlVzZXIoKTtcblxuICAvLyDnlLPoq4vlhYjjg6bjg7zjgrbvvIjmib/oqo3ogIXvvIlcbiAgdG9Vc2VyLmlkID0gcmVxdWVzdC51c2VyLmlkO1xuICAvLyDnlLPoq4vlhYPjg6bjg7zjgrbvvIjnlLPoq4vogIXvvIlcbiAgZnJvbVVzZXIuaWQgPSByZXF1ZXN0LnBhcmFtcy5mYW1pbHlBcHBsaWNhdGlvbi5mcm9tVXNlck9iamVjdElkO1xuXG4gIC8vIOeUs+iri+iAheOAgeaJv+iqjeiAheOBrkZhbWlseeODh+ODvOOCv+OCkuaknOe0ouOBmeOCi+OAglxuICB2YXIgZmFtaWx5UXVlcnkgPSBuZXcgUGFyc2UuUXVlcnkoJ0ZhbWlseScpO1xuICBmYW1pbHlRdWVyeS5jb250YWluZWRJbignbWVtYmVyJywgWyByZXF1ZXN0LnVzZXIsIGZyb21Vc2VyIF0pO1xuXG4gIHZhciBmYW1pbHk6IFBhcnNlLk9iamVjdDtcbiAgdmFyIGZhbWlseVJvbGU6IFBhcnNlLlJvbGU7XG4gIGZhbWlseVF1ZXJ5LmZpcnN0KClcbiAgLnRoZW4oKGZhbWlseTogUGFyc2UuT2JqZWN0KSA9PiB7XG4gICAgY29uc29sZS5sb2coJ2VudGVyIDEnKTtcbiAgICBjb25zb2xlLmxvZyhmYW1pbHkpO1xuXG4gICAgaWYgKCFmYW1pbHkpIHtcbiAgICAgIGNvbnNvbGUubG9nKCfml6LlrZhmYW1pbHnjgarjgZcnKTtcbiAgICAgIC8vIOaXouWtmOOBrkZhbWlseeOBjOOBquOBhOOBruOBp+S9nOOCi+OAglxuICAgICAgdmFyIFBhcnNlRmFtaWx5ID0gUGFyc2UuT2JqZWN0LmV4dGVuZCgnRmFtaWx5Jyk7XG4gICAgICBmYW1pbHkgPSBuZXcgUGFyc2VGYW1pbHkoKTtcbiAgICAgIGZhbWlseS5zZXRBQ0wobmV3IFBhcnNlLkFDTCgpKTtcbiAgICB9XG4gICAgdmFyIHJlbGF0aW9uID0gZmFtaWx5LnJlbGF0aW9uKCdtZW1iZXInKTtcbiAgICByZWxhdGlvbi5hZGQodG9Vc2VyKTtcbiAgICByZWxhdGlvbi5hZGQoZnJvbVVzZXIpO1xuICAgIHJldHVybiBmYW1pbHkuc2F2ZSgpO1xuXG4gIH0pLnRoZW4oKHJlc3VsdDogUGFyc2UuT2JqZWN0KSA9PiB7XG4gICAgY29uc29sZS5sb2coJ2VudGVyIDInKTtcbiAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xuXG4gICAgZmFtaWx5ID0gcmVzdWx0O1xuXG4gICAgLy8gLkZhbWlseeOBruOCquODluOCuOOCp+OCr+ODiElE44KSbmFtZeOBq+aMgeOBpFJvbGXjgpLmjqLjgZnjgIJcbiAgICB2YXIgZmFtaWx5Um9sZVF1ZXJ5ID0gbmV3IFBhcnNlLlF1ZXJ5KFBhcnNlLlJvbGUpO1xuICAgIGNvbnNvbGUubG9nKHJlc3VsdC5pZCk7XG4gICAgZmFtaWx5Um9sZVF1ZXJ5LmVxdWFsVG8oJ25hbWUnLCByZXN1bHQuaWQpO1xuICAgIHJldHVybiBmYW1pbHlSb2xlUXVlcnkuZmlyc3QoKTtcblxuICB9KS50aGVuKChyZXN1bHQ6IFBhcnNlLlJvbGUpID0+IHtcbiAgICBjb25zb2xlLmxvZygnZW50ZXIgMycpO1xuICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XG5cbiAgICBpZiAocmVzdWx0KSB7XG4gICAgICBjb25zb2xlLmxvZygn44Ot44O844Or44GC44KKOiBuYW1lID0gJyArIGZhbWlseS5pZCArICc6ICcgKyByZXN1bHQpO1xuICAgICAgZmFtaWx5Um9sZSA9IHJlc3VsdDtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8g5pei5a2YUm9sZeOBjOOBquOBkeOCjOOBsOS9nOOCi+OAglxuICAgICAgZmFtaWx5Um9sZSA9IG5ldyBQYXJzZS5Sb2xlKGZhbWlseS5pZCwgbmV3IFBhcnNlLkFDTCgpKTtcbiAgICAgIGNvbnNvbGUubG9nKCfjg63jg7zjg6vjgarjgZc6IG5hbWUgPSAnICsgZmFtaWx5LmlkICsgJ+OCkuS9nOOCiuOBvuOBmeOAgicpO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyhmYW1pbHlSb2xlLmdldFVzZXJzKCkpO1xuICAgIGZhbWlseVJvbGUuZ2V0VXNlcnMoKS5hZGQodG9Vc2VyKTtcbiAgICBmYW1pbHlSb2xlLmdldFVzZXJzKCkuYWRkKGZyb21Vc2VyKTtcbiAgICByZXR1cm4gZmFtaWx5Um9sZS5zYXZlKCk7XG5cbiAgfSkudGhlbigocmVzdWx0OiBQYXJzZS5Sb2xlKSA9PiB7XG4gICAgY29uc29sZS5sb2coJ2VudGVyIDQnKTtcbiAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xuXG4gICAgLy8g5om/6KqN6ICF44Go55Sz6KuL6ICF44Gu44GT44Gp44KC5oOF5aCx44KS5Y+W5b6XXG4gICAgbGV0IFBhcnNlQ2hpbGQgPSBQYXJzZS5PYmplY3QuZXh0ZW5kKCdDaGlsZCcpO1xuICAgIGxldCBxdWVyeSA9IG5ldyBQYXJzZS5RdWVyeShQYXJzZUNoaWxkKTtcbiAgICBxdWVyeS5jb250YWluZWRJbignY3JlYXRlZEJ5JywgWyB0b1VzZXIsIGZyb21Vc2VyIF0pO1xuICAgIHJldHVybiBxdWVyeS5maW5kKCk7XG5cbiAgfSkudGhlbigocGFyc2VDaGlsZHJlbjogUGFyc2UuT2JqZWN0W10pID0+IHtcbiAgICBjb25zb2xlLmxvZygncGFyc2VDaGlsZHJlbjonICsgcGFyc2VDaGlsZHJlbik7XG5cbiAgICB2YXIgcHJvbWlzZXMgPSBbXTtcblxuICAgIHBhcnNlQ2hpbGRyZW4uZm9yRWFjaCgocGFyc2VDaGlsZDogUGFyc2UuT2JqZWN0KSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygncGFyc2VDaGlsZDonICsgcGFyc2VDaGlsZCk7XG4gICAgICB2YXIgY2hpbGRBQ0wgPSBuZXcgUGFyc2UuQUNMKCk7XG4gICAgICBjaGlsZEFDTC5zZXRSb2xlUmVhZEFjY2VzcyhmYW1pbHlSb2xlLCB0cnVlKTtcbiAgICAgIGNoaWxkQUNMLnNldFJvbGVXcml0ZUFjY2VzcyhmYW1pbHlSb2xlLCB0cnVlKTtcbiAgICAgIHBhcnNlQ2hpbGQuc2V0QUNMKGNoaWxkQUNMKTtcbiAgICB9KTtcbiAgICBwcm9taXNlcy5wdXNoKFBhcnNlLk9iamVjdC5zYXZlQWxsKHBhcnNlQ2hpbGRyZW4pKTtcbiAgICByZXR1cm4gUGFyc2UuUHJvbWlzZS53aGVuKHByb21pc2VzKTtcblxuICB9KS50aGVuKCgpID0+IHtcbiAgICBjb25zb2xlLmxvZygnZW50ZXIgNScpO1xuXG4gICAgLy8g5YWo5oqV56i/44KS5Y+W5b6XXG4gICAgbGV0IFBhcnNlVm9pY2UgPSBQYXJzZS5PYmplY3QuZXh0ZW5kKCdWb2ljZScpO1xuICAgIC8vIFRPRE86ICd1c2VyJ+OBp+OBquOBjydjcmVhdGVkQnkn44Gr44GX44Gf44GE44CCXG5cbiAgICBsZXQgcXVlcnkgPSBuZXcgUGFyc2UuUXVlcnkoUGFyc2VWb2ljZSk7XG4gICAgcXVlcnkuY29udGFpbmVkSW4oJ3VzZXInLCBbIHRvVXNlciwgZnJvbVVzZXIgXSk7XG4gICAgcmV0dXJuIHF1ZXJ5LmNvdW50KCk7XG5cbiAgfSkudGhlbigoY291bnRSZXN1bHQ6IG51bWJlcikgPT4ge1xuXG4gICAgY29uc29sZS5sb2coJ2NvdW50UmVzdWx0OicgKyBjb3VudFJlc3VsdCk7XG5cbiAgICB2YXIgcHJvbWlzZXMgPSBbXTtcblxuICAgIGxldCBQYXJzZVZvaWNlID0gUGFyc2UuT2JqZWN0LmV4dGVuZCgnVm9pY2UnKTtcbiAgICAvLyBUT0RPOiAndXNlcifjgafjgarjgY8nY3JlYXRlZEJ5J+OBq+OBl+OBn+OBhOOAglxuXG4gICAgbGV0IHF1ZXJ5ID0gbmV3IFBhcnNlLlF1ZXJ5KFBhcnNlVm9pY2UpO1xuICAgIHF1ZXJ5LmNvbnRhaW5lZEluKCd1c2VyJywgWyB0b1VzZXIsIGZyb21Vc2VyIF0pO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudFJlc3VsdCAvIDEwMDA7IGkrKykge1xuICAgICAgcXVlcnkubGltaXQoMTAwMCk7XG4gICAgICBxdWVyeS5za2lwKDEwMDAgKiBpKTtcbiAgICAgIHByb21pc2VzLnB1c2gocXVlcnkuZmluZCgpKTtcbiAgICB9XG4gICAgcmV0dXJuIFBhcnNlLlByb21pc2Uud2hlbihwcm9taXNlcyk7XG5cbiAgfSkudGhlbigoLi4udm9pY2VzQXJyYXk6IFBhcnNlLk9iamVjdFtdW10pID0+IHtcblxuICAgIGNvbnNvbGUubG9nKCd2b2ljZXM6JyArIHZvaWNlc0FycmF5KTtcblxuICAgIHZhciBwcm9taXNlcyA9IFtdO1xuXG4gICAgdm9pY2VzQXJyYXkuZm9yRWFjaCgodm9pY2VzOiBQYXJzZS5PYmplY3RbXSkgPT4ge1xuXG4gICAgICB2b2ljZXMuZm9yRWFjaCgodm9pY2U6IFBhcnNlLk9iamVjdCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygndm9pY2U6JyArIHZvaWNlLmlkICsgJzonICsgZmFtaWx5Um9sZS5pZCk7XG4gICAgICAgIHZhciB2b2ljZUFDTCA9IG5ldyBQYXJzZS5BQ0woKTtcbiAgICAgICAgdm9pY2VBQ0wuc2V0Um9sZVJlYWRBY2Nlc3MoZmFtaWx5Um9sZSwgdHJ1ZSk7XG4gICAgICAgIHZvaWNlQUNMLnNldFJvbGVXcml0ZUFjY2VzcyhmYW1pbHlSb2xlLCB0cnVlKTtcblxuICAgICAgICBpZiAodm9pY2UuZ2V0QUNMKCkuZ2V0UHVibGljUmVhZEFjY2VzcygpKSB7XG4gICAgICAgICAgdm9pY2VBQ0wuc2V0UHVibGljUmVhZEFjY2Vzcyh0cnVlKTtcbiAgICAgICAgICBjb25zb2xlLmxvZygndm9pY2U6IHNldFB1YmxpY1JlYWRBY2Nlc3MnKTtcbiAgICAgICAgfVxuICAgICAgICB2b2ljZS5zZXRBQ0wodm9pY2VBQ0wpO1xuICAgICAgfSk7XG4gICAgICBwcm9taXNlcy5wdXNoKFBhcnNlLk9iamVjdC5zYXZlQWxsKHZvaWNlcykpO1xuICAgICAgcmV0dXJuIFBhcnNlLlByb21pc2Uud2hlbihwcm9taXNlcyk7XG5cbiAgICB9KTtcblxuICB9KS50aGVuKCgpID0+IHtcbiAgICBjb25zb2xlLmxvZygnZW50ZXIgNicpO1xuXG4gICAgcmVzcG9uc2Uuc3VjY2VzcygnU3VjY2VzcyEnKTtcbiAgfSxcbiAgKGVycm9yOiBQYXJzZS5FcnJvcikgPT4ge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yOiAnICsgZXJyb3IuY29kZSArICcgJyArIGVycm9yLm1lc3NhZ2UpO1xuICAgIHJlc3BvbnNlLmVycm9yKCdFcnJvciEgc2VlIGxvZyBvbiBQYXJzZS5jb20uJyk7XG4gIH0pO1xufSk7XG5cblBhcnNlLkNsb3VkLmRlZmluZSgnZ2V0UmVxdWVzdFVzZXJzRmFtaWx5Um9sZScsIGZ1bmN0aW9uKHJlcXVlc3Q6IFBhcnNlLkNsb3VkLkZ1bmN0aW9uUmVxdWVzdCwgcmVzcG9uc2U6IFBhcnNlLkNsb3VkLkZ1bmN0aW9uUmVzcG9uc2UpIHtcblxuICBQYXJzZS5DbG91ZC51c2VNYXN0ZXJLZXkoKTtcblxuICB2YXIgZmFtaWx5UXVlcnkgPSBuZXcgUGFyc2UuUXVlcnkoJ0ZhbWlseScpO1xuICBmYW1pbHlRdWVyeS5lcXVhbFRvKCdtZW1iZXInLCByZXF1ZXN0LnVzZXIpO1xuICBmYW1pbHlRdWVyeS5maXJzdCgpXG4gIC50aGVuKChyZXN1bHQ6IFBhcnNlLk9iamVjdCkgPT4ge1xuXG4gICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgIHZhciByb2xlUXVlcnkgPSBuZXcgUGFyc2UuUXVlcnkoUGFyc2UuUm9sZSk7XG4gICAgICAgIHJvbGVRdWVyeS5lcXVhbFRvKCduYW1lJywgcmVzdWx0LmlkKTtcbiAgICAgICAgcmV0dXJuIHJvbGVRdWVyeS5maXJzdCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFBhcnNlLlByb21pc2UuYXMobnVsbCk7XG4gICAgICB9XG4gIH0pLnRoZW4oKHJlc3VsdDogUGFyc2UuUm9sZSkgPT4ge1xuICAgIHJlc3BvbnNlLnN1Y2Nlc3MocmVzdWx0KTtcbiAgfSk7XG59KTtcblxuUGFyc2UuQ2xvdWQuZGVmaW5lKCdnZXRSZXF1ZXN0VXNlcnNGYW1pbHlNZW1iZXInLCBmdW5jdGlvbihyZXF1ZXN0OiBQYXJzZS5DbG91ZC5GdW5jdGlvblJlcXVlc3QsIHJlc3BvbnNlOiBQYXJzZS5DbG91ZC5GdW5jdGlvblJlc3BvbnNlKSB7XG5cbiAgUGFyc2UuQ2xvdWQudXNlTWFzdGVyS2V5KCk7XG5cbiAgdmFyIGZhbWlseVF1ZXJ5ID0gbmV3IFBhcnNlLlF1ZXJ5KCdGYW1pbHknKTtcbiAgZmFtaWx5UXVlcnkuY29udGFpbmVkSW4oJ21lbWJlcicsIFsgcmVxdWVzdC51c2VyIF0pO1xuICBmYW1pbHlRdWVyeS5maXJzdCgpXG4gIC50aGVuKChyZXN1bHQ6IFBhcnNlLk9iamVjdCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XG4gICAgaWYgKHJlc3VsdCkge1xuXG4gICAgICB2YXIgcXVlcnkgPSByZXN1bHQucmVsYXRpb24oJ21lbWJlcicpLnF1ZXJ5KCk7XG4gICAgICAvLyDku5bjg6bjg7zjgrbjgavov5TljbTjgZnjgovjga7jgafjg5Hjgrnjg6/jg7zjg4njgarjganjga/ov5TjgZXjgarjgYTjgIJcbiAgICAgIHF1ZXJ5LnNlbGVjdCgndXNlcm5hbWUnLCAnaWNvblVybCcpO1xuICAgICAgcmV0dXJuIHF1ZXJ5LmZpbmQoKTtcblxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gIH0pLnRoZW4oKHJlc3VsdDogUGFyc2UuT2JqZWN0W10pID0+IHtcbiAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xuICAgIHJlc3BvbnNlLnN1Y2Nlc3MocmVzdWx0KTtcbiAgfSxcbiAgKGVycm9yOiBQYXJzZS5FcnJvcikgPT4ge1xuICAgIHJlc3BvbnNlLmVycm9yKGVycm9yKTtcbiAgfSk7XG59KTtcblxuUGFyc2UuQ2xvdWQuZGVmaW5lKCdnZXRGYW1pbHlBcHBUb1JlcXVlc3RVc2VyJywgZnVuY3Rpb24ocmVxdWVzdDogUGFyc2UuQ2xvdWQuRnVuY3Rpb25SZXF1ZXN0LCByZXNwb25zZTogUGFyc2UuQ2xvdWQuRnVuY3Rpb25SZXNwb25zZSkge1xuXG4gIFBhcnNlLkNsb3VkLnVzZU1hc3RlcktleSgpO1xuXG4gIHZhciBQYXJzZUZhbWlseUFwcGxpY2F0aW9uID0gUGFyc2UuT2JqZWN0LmV4dGVuZCgnRmFtaWx5QXBwbGljYXRpb24nKTtcbiAgdmFyIHF1ZXJ5ID0gbmV3IFBhcnNlLlF1ZXJ5KFBhcnNlRmFtaWx5QXBwbGljYXRpb24pO1xuICBxdWVyeS5kZXNjZW5kaW5nKCdjcmVhdGVkQXQnKTtcbiAgLy8g6Ieq5YiG5a6b44GmXG4gIHF1ZXJ5LmVxdWFsVG8oJ3RvVXNlcicsIHJlcXVlc3QudXNlcik7XG4gIHF1ZXJ5LmluY2x1ZGUoJ2Zyb21Vc2VyJyk7XG4gIHF1ZXJ5LmZpbmQoKVxuICAudGhlbigocmVzdWx0OiBQYXJzZS5PYmplY3RbXSkgPT4ge1xuICAgIHJlc3BvbnNlLnN1Y2Nlc3MocmVzdWx0KTtcbiAgfSxcbiAgKGVycm9yOiBQYXJzZS5FcnJvcikgPT4ge1xuICAgIHJlc3BvbnNlLmVycm9yKGVycm9yKTtcbiAgfSk7XG59KTtcblxuUGFyc2UuQ2xvdWQuZGVmaW5lKCdnZXRDb3VudE9mRmFtaWx5QXBwVG9SZXF1ZXN0VXNlcicsIGZ1bmN0aW9uKHJlcXVlc3Q6IFBhcnNlLkNsb3VkLkZ1bmN0aW9uUmVxdWVzdCwgcmVzcG9uc2U6IFBhcnNlLkNsb3VkLkZ1bmN0aW9uUmVzcG9uc2UpIHtcblxuICBQYXJzZS5DbG91ZC51c2VNYXN0ZXJLZXkoKTtcblxuICB2YXIgUGFyc2VGYW1pbHlBcHBsaWNhdGlvbiA9IFBhcnNlLk9iamVjdC5leHRlbmQoJ0ZhbWlseUFwcGxpY2F0aW9uJyk7XG4gIHZhciBxdWVyeSA9IG5ldyBQYXJzZS5RdWVyeShQYXJzZUZhbWlseUFwcGxpY2F0aW9uKTtcbiAgcXVlcnkuZGVzY2VuZGluZygnY3JlYXRlZEF0Jyk7XG4gIC8vIOiHquWIhuWum+OBplxuICBxdWVyeS5lcXVhbFRvKCd0b1VzZXInLCByZXF1ZXN0LnVzZXIpO1xuICBxdWVyeS5pbmNsdWRlKCdmcm9tVXNlcicpO1xuICBxdWVyeS5jb3VudCgpXG4gIC50aGVuKChjb3VudDogbnVtYmVyKSA9PiB7XG4gICAgcmVzcG9uc2Uuc3VjY2Vzcyhjb3VudCk7XG4gIH0sXG4gIChlcnJvcjogUGFyc2UuRXJyb3IpID0+IHtcbiAgICByZXNwb25zZS5lcnJvcihlcnJvcik7XG4gIH0pO1xufSk7XG5cblBhcnNlLkNsb3VkLmRlZmluZSgnZ2V0RmFtaWx5QXBwRnJvbVJlcXVlc3RVc2VyJywgZnVuY3Rpb24ocmVxdWVzdDogUGFyc2UuQ2xvdWQuRnVuY3Rpb25SZXF1ZXN0LCByZXNwb25zZTogUGFyc2UuQ2xvdWQuRnVuY3Rpb25SZXNwb25zZSkge1xuXG4gIFBhcnNlLkNsb3VkLnVzZU1hc3RlcktleSgpO1xuXG4gIHZhciBQYXJzZUZhbWlseUFwcGxpY2F0aW9uID0gUGFyc2UuT2JqZWN0LmV4dGVuZCgnRmFtaWx5QXBwbGljYXRpb24nKTtcbiAgdmFyIHF1ZXJ5ID0gbmV3IFBhcnNlLlF1ZXJ5KFBhcnNlRmFtaWx5QXBwbGljYXRpb24pO1xuICBxdWVyeS5kZXNjZW5kaW5nKCdjcmVhdGVkQXQnKTtcbiAgLy8g6Ieq5YiG5a6b44GmXG4gIHF1ZXJ5LmVxdWFsVG8oJ2Zyb21Vc2VyJywgcmVxdWVzdC51c2VyKTtcbiAgcXVlcnkuaW5jbHVkZSgnZnJvbVVzZXInKTtcbiAgcXVlcnkuaW5jbHVkZSgndG9Vc2VyJyk7XG4gIHF1ZXJ5LmZpbmQoKVxuICAudGhlbigocmVzdWx0OiBQYXJzZS5PYmplY3RbXSkgPT4ge1xuICAgIHJlc3BvbnNlLnN1Y2Nlc3MocmVzdWx0KTtcbiAgfSxcbiAgKGVycm9yOiBQYXJzZS5FcnJvcikgPT4ge1xuICAgIHJlc3BvbnNlLmVycm9yKGVycm9yKTtcbiAgfSk7XG59KTtcblxudmFyIFBhcnNlSW1hZ2U6IGFueSA9IHJlcXVpcmUoJ3BhcnNlLWltYWdlJyk7XG5cbi8qXG4gKiDjg5fjg63jg5XjgqPjg7zjg6vkv53lrZjmmYLjgavnlLvlg4/jgpIxNjBweOOBq+ODquOCteOCpOOCulxuICovXG5QYXJzZS5DbG91ZC5iZWZvcmVTYXZlKCdfVXNlcicsIChyZXF1ZXN0OiBQYXJzZS5DbG91ZC5CZWZvcmVTYXZlUmVxdWVzdCwgcmVzcG9uc2U6IFBhcnNlLkNsb3VkLkJlZm9yZVNhdmVSZXNwb25zZSkgPT4ge1xuXG4gIHZhciB1c2VyID0gcmVxdWVzdC5vYmplY3Q7XG4gIGlmICghdXNlci5nZXQoJ2ljb24nKSkge1xuICAgIHJlc3BvbnNlLnN1Y2Nlc3ModXNlcik7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKCF1c2VyLmRpcnR5KCdpY29uJykpIHtcbiAgICAvLyAuVGhlIHByb2ZpbGUgcGhvdG8gaXNuJ3QgYmVpbmcgbW9kaWZpZWQuXG4gICAgcmVzcG9uc2Uuc3VjY2Vzcyh1c2VyKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBQYXJzZS5DbG91ZC5odHRwUmVxdWVzdCh7XG4gICAgLy8gX1VzZXLjga5iZWZvcmVTYXZl44Gq44Gu44Gn44CBaWNvblVybOOBr+OBvuOBoOabtOaWsOOBleOCjOOBpuOBhOOBquOBhOOBruOBp2ljb24udXJsKCnjgpLkvb/jgYbjgIJcbiAgICB1cmw6IHVzZXIuZ2V0KCdpY29uJykudXJsKClcblxuICB9KS50aGVuKChyZXNwb25zZTogUGFyc2UuQ2xvdWQuSHR0cFJlc3BvbnNlKSA9PiB7XG4gICAgY29uc29sZS5sb2coMyk7XG4gICAgdmFyIGltYWdlID0gbmV3IFBhcnNlSW1hZ2UoKTtcbiAgICByZXR1cm4gaW1hZ2Uuc2V0RGF0YShyZXNwb25zZS5idWZmZXIpO1xuXG4gIH0pLnRoZW4oKGltYWdlOiBhbnkpID0+IHtcbiAgICAvLyAuQ3JvcCB0aGUgaW1hZ2UgdG8gdGhlIHNtYWxsZXIgb2Ygd2lkdGggb3IgaGVpZ2h0LlxuICAgIHZhciBzaXplID0gTWF0aC5taW4oaW1hZ2Uud2lkdGgoKSwgaW1hZ2UuaGVpZ2h0KCkpO1xuICAgIHJldHVybiBpbWFnZS5jcm9wKHtcbiAgICAgIGxlZnQ6IChpbWFnZS53aWR0aCgpIC0gc2l6ZSkgLyAyLFxuICAgICAgdG9wOiAoaW1hZ2UuaGVpZ2h0KCkgLSBzaXplKSAvIDIsXG4gICAgICB3aWR0aDogc2l6ZSxcbiAgICAgIGhlaWdodDogc2l6ZVxuICAgIH0pO1xuXG4gIH0pLnRoZW4oKGltYWdlOiBhbnkpID0+IHtcbiAgICAvLyAuUmVzaXplIHRoZSBpbWFnZSB0byA2NHg2NC5cbiAgICByZXR1cm4gaW1hZ2Uuc2NhbGUoe1xuICAgICAgd2lkdGg6IDE2MCxcbiAgICAgIGhlaWdodDogMTYwXG4gICAgfSk7XG5cbiAgfSkudGhlbigoaW1hZ2U6IGFueSkgPT4ge1xuICAgIC8vIC5NYWtlIHN1cmUgaXQncyBhIEpQRUcgdG8gc2F2ZSBkaXNrIHNwYWNlIGFuZCBiYW5kd2lkdGguXG4gICAgcmV0dXJuIGltYWdlLnNldEZvcm1hdCgnSlBFRycpO1xuXG4gIH0pLnRoZW4oKGltYWdlOiBhbnkpID0+IHtcbiAgICAvLyAuR2V0IHRoZSBpbWFnZSBkYXRhIGluIGEgQnVmZmVyLlxuICAgIHJldHVybiBpbWFnZS5kYXRhKCk7XG5cbiAgfSkudGhlbigoYnVmZmVyOiBhbnkpID0+IHtcbiAgICAvLyAuU2F2ZSB0aGUgaW1hZ2UgaW50byBhIG5ldyBmaWxlLlxuICAgIHZhciBiYXNlNjQgPSBidWZmZXIudG9TdHJpbmcoJ2Jhc2U2NCcpO1xuICAgIHZhciBjcm9wcGVkID0gbmV3IFBhcnNlLkZpbGUoJ3Bob3RvLmpwZycsIHsgYmFzZTY0OiBiYXNlNjQgfSk7XG4gICAgcmV0dXJuIGNyb3BwZWQuc2F2ZSgpO1xuXG4gIH0pLnRoZW4oKGNyb3BwZWQ6IGFueSkgPT4ge1xuICAgIC8vIC5BdHRhY2ggdGhlIGltYWdlIGZpbGUgdG8gdGhlIG9yaWdpbmFsIG9iamVjdC5cbiAgICB1c2VyLnNldCgnaWNvbicsIGNyb3BwZWQpO1xuICAgIHVzZXIuc2V0KCdpY29uVXJsJywgY3JvcHBlZC51cmwoKSk7XG5cbiAgfSkudGhlbigoKSA9PiB7XG4gICAgcmVzcG9uc2Uuc3VjY2Vzcyh1c2VyKTtcbiAgfSwgKGVycm9yOiBQYXJzZS5FcnJvcikgPT4ge1xuICAgIGNvbnNvbGUubG9nKDkpO1xuICAgIHJlc3BvbnNlLmVycm9yKGVycm9yKTtcbiAgfSk7XG59KTtcblxuLypcbiAqIOaKleeov+OBq+eUu+WDj+OCkjQ4MHB444Gr44Oq44K144Kk44K6XG4gKi9cblBhcnNlLkNsb3VkLmJlZm9yZVNhdmUoJ1ZvaWNlJywgKHJlcXVlc3Q6IFBhcnNlLkNsb3VkLkJlZm9yZVNhdmVSZXF1ZXN0LCByZXNwb25zZTogUGFyc2UuQ2xvdWQuQmVmb3JlU2F2ZVJlc3BvbnNlKSA9PiB7XG4gIHZhciB2b2ljZSA9IHJlcXVlc3Qub2JqZWN0O1xuICBpZiAoIXZvaWNlLmdldCgncGhvdG8nKSkge1xuICAgIHJlc3BvbnNlLnN1Y2Nlc3Modm9pY2UpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICghdm9pY2UuZGlydHkoJ3Bob3RvJykpIHtcbiAgICAvLyAuVGhlIHByb2ZpbGUgcGhvdG8gaXNuJ3QgYmVpbmcgbW9kaWZpZWQuXG4gICAgcmVzcG9uc2Uuc3VjY2Vzcyh2b2ljZSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgUGFyc2UuQ2xvdWQuaHR0cFJlcXVlc3Qoe1xuICAgIC8vIC5Wb2ljZeOBrmJlZm9yZVNhdmXjgarjga7jgafjgIFwaG90b1VybOOBr+OBvuOBoOabtOaWsOOBleOCjOOBpuOBhOOBquOBhOOBruOBp3Bob3RvLnVybCgp44KS5L2/44GG44CCXG4gICAgdXJsOiB2b2ljZS5nZXQoJ3Bob3RvJykudXJsKClcblxuICB9KS50aGVuKChyZXNwb25zZTogUGFyc2UuQ2xvdWQuSHR0cFJlc3BvbnNlKSA9PiB7XG4gICAgY29uc29sZS5sb2coJ2JlZm9yZSBzYXZlIHZvaWNlOiA0JylcbiAgICB2YXIgaW1hZ2UgPSBuZXcgUGFyc2VJbWFnZSgpO1xuICAgIHJldHVybiBpbWFnZS5zZXREYXRhKHJlc3BvbnNlLmJ1ZmZlcik7XG5cbiAgfSkudGhlbigoaW1hZ2U6IGFueSkgPT4ge1xuICAgIC8vIC5SZXNpemUgdGhlIGltYWdlIHRvIDY0eDY0LlxuICAgIHZhciBzY2FsZSA9IDQ4MCAvIE1hdGgubWF4KGltYWdlLndpZHRoKCksIGltYWdlLmhlaWdodCgpKTtcbiAgICByZXR1cm4gaW1hZ2Uuc2NhbGUoe1xuICAgICAgd2lkdGg6IGltYWdlLndpZHRoKCkgKiBzY2FsZSxcbiAgICAgIGhlaWdodDogaW1hZ2UuaGVpZ2h0KCkgKiBzY2FsZVxuICAgIH0pO1xuXG4gIH0pLnRoZW4oKGltYWdlOiBhbnkpID0+IHtcbiAgICAvLyAuTWFrZSBzdXJlIGl0J3MgYSBKUEVHIHRvIHNhdmUgZGlzayBzcGFjZSBhbmQgYmFuZHdpZHRoLlxuICAgIHJldHVybiBpbWFnZS5zZXRGb3JtYXQoJ0pQRUcnKTtcblxuICB9KS50aGVuKChpbWFnZTogYW55KSA9PiB7XG4gICAgLy8gLkdldCB0aGUgaW1hZ2UgZGF0YSBpbiBhIEJ1ZmZlci5cbiAgICByZXR1cm4gaW1hZ2UuZGF0YSgpO1xuXG4gIH0pLnRoZW4oKGJ1ZmZlcjogYW55KSA9PiB7XG4gICAgLy8gLlNhdmUgdGhlIGltYWdlIGludG8gYSBuZXcgZmlsZS5cbiAgICB2YXIgYmFzZTY0ID0gYnVmZmVyLnRvU3RyaW5nKCdiYXNlNjQnKTtcbiAgICB2YXIgY3JvcHBlZCA9IG5ldyBQYXJzZS5GaWxlKCdwaG90by5qcGcnLCB7IGJhc2U2NDogYmFzZTY0IH0pO1xuICAgIHJldHVybiBjcm9wcGVkLnNhdmUoKTtcblxuICB9KS50aGVuKChjcm9wcGVkOiBhbnkpID0+IHtcbiAgICAvLyAuQXR0YWNoIHRoZSBpbWFnZSBmaWxlIHRvIHRoZSBvcmlnaW5hbCBvYmplY3QuXG4gICAgdm9pY2Uuc2V0KCdwaG90bycsIGNyb3BwZWQpO1xuICAgIHZvaWNlLnNldCgncGhvdG9VcmwnLCBjcm9wcGVkLnVybCgpKTtcblxuICB9KS50aGVuKCgpID0+IHtcbiAgICByZXNwb25zZS5zdWNjZXNzKHZvaWNlKTtcbiAgfSwgKGVycm9yOiBQYXJzZS5FcnJvcikgPT4ge1xuICAgIGNvbnNvbGUubG9nKDkpO1xuICAgIHJlc3BvbnNlLmVycm9yKGVycm9yKTtcbiAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==